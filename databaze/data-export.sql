--------------------------------------------------------
--  File created - neděle-prosince-07-2025   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Type T_KVETINA_KOSIK_LIST
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TYPE "ST67009"."T_KVETINA_KOSIK_LIST" AS TABLE OF T_KVETINA_KOSIK_REC;

/
--------------------------------------------------------
--  DDL for Type T_KVETINA_KOSIK_REC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TYPE "ST67009"."T_KVETINA_KOSIK_REC" AS OBJECT (
    id_kvetina  NUMBER,
    pocet       NUMBER
);

/
--------------------------------------------------------
--  DDL for Sequence LIDE_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."LIDE_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence SEQ_CUA_ID
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."SEQ_CUA_ID"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
  GRANT SELECT ON "ST67009"."SEQ_CUA_ID" TO PUBLIC;
--------------------------------------------------------
--  DDL for Sequence SEQ_CUS_ID
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."SEQ_CUS_ID"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 21 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
  GRANT SELECT ON "ST67009"."SEQ_CUS_ID" TO PUBLIC;
--------------------------------------------------------
--  DDL for Sequence SEQ_USR_ID
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."SEQ_USR_ID"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
  GRANT SELECT ON "ST67009"."SEQ_USR_ID" TO PUBLIC;
--------------------------------------------------------
--  DDL for Sequence S_ADRESY_ID_ADRESA
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_ADRESY_ID_ADRESA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 40 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_DOTAZY_ID_DOTAZ
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_DOTAZY_ID_DOTAZ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 56 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_KATEGORIE_ID_KATEGORIE
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_KATEGORIE_ID_KATEGORIE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 38 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_KOSIKY_ID_KOSIK
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_KOSIKY_ID_KOSIK"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 97 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_KVETINYKOSIKY_ID_KVETINA
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_KVETINYKOSIKY_ID_KVETINA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_KVETINY_ID_KVETINA
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_KVETINY_ID_KVETINA"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 17 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_LOGAKCE_ID_LOG_AKCE
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_LOGAKCE_ID_LOG_AKCE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 4 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_LOG_ID_LOG
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_LOG_ID_LOG"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 501 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_MESTA_ID_MESTO
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_MESTA_ID_MESTO"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 49 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_OBRAZKY_ID_OBRAZEK
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_OBRAZKY_ID_OBRAZEK"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 24 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_OPRAVNENI_ID_OPRAVNENI
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_OPRAVNENI_ID_OPRAVNENI"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 13 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_PSC_ID_PSC
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_PSC_ID_PSC"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 29 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_STAVYOBJEDNAVEK_ID_STAV_OBJEDNAVKY
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_STAVYOBJEDNAVEK_ID_STAV_OBJEDNAVKY"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 7 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_ULICE_ID_ULICE
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_ULICE_ID_ULICE"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 32 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_UZIVATELE_ID_UZIVATEL
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_UZIVATELE_ID_UZIVATEL"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 34 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence S_ZPUSOBYPLATEB_ID_ZPUSOB_PLATBY
--------------------------------------------------------

   CREATE SEQUENCE  "ST67009"."S_ZPUSOBYPLATEB_ID_ZPUSOB_PLATBY"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 11 NOCACHE  ORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Table ADRESY
--------------------------------------------------------

  CREATE TABLE "ST67009"."ADRESY" 
   (	"ID_ADRESA" NUMBER(10,0), 
	"CP" NUMBER(10,0), 
	"ID_MESTO" NUMBER(10,0), 
	"ID_ULICE" NUMBER(10,0), 
	"ID_PSC" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table DOTAZY
--------------------------------------------------------

  CREATE TABLE "ST67009"."DOTAZY" 
   (	"ID_DOTAZ" NUMBER(10,0), 
	"DATUM_PODANI" TIMESTAMP (0) WITH LOCAL TIME ZONE, 
	"VEREJNY" NUMBER(1,0) DEFAULT 0, 
	"TEXT" CLOB, 
	"ODPOVED" CLOB, 
	"ID_ODPOVIDAJICI_UZIVATEL" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" 
 LOB ("TEXT") STORE AS SECUREFILE (
  TABLESPACE "STUDENTI" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 LOB ("ODPOVED") STORE AS SECUREFILE (
  TABLESPACE "STUDENTI" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table KATEGORIE
--------------------------------------------------------

  CREATE TABLE "ST67009"."KATEGORIE" 
   (	"ID_KATEGORIE" NUMBER(10,0), 
	"NAZEV" VARCHAR2(32 CHAR), 
	"ID_NADRAZENE_KATEGORIE" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table KOSIKY
--------------------------------------------------------

  CREATE TABLE "ST67009"."KOSIKY" 
   (	"ID_KOSIK" NUMBER(10,0), 
	"DATUM_VYTVORENI" TIMESTAMP (0) WITH LOCAL TIME ZONE, 
	"CENA" NUMBER(12,2), 
	"SLEVA" NUMBER(2,0), 
	"ID_UZIVATEL" NUMBER(10,0), 
	"ID_STAV_OBJEDNAVKY" NUMBER(10,0), 
	"ID_ZPUSOB_PLATBY" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table KVETINY
--------------------------------------------------------

  CREATE TABLE "ST67009"."KVETINY" 
   (	"ID_KVETINA" NUMBER(10,0), 
	"NAZEV" VARCHAR2(32 CHAR), 
	"CENA" NUMBER(10,2), 
	"ID_KATEGORIE" NUMBER(10,0), 
	"ID_OBRAZEK" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table KVETINYKOSIKY
--------------------------------------------------------

  CREATE TABLE "ST67009"."KVETINYKOSIKY" 
   (	"ID_KVETINA" NUMBER(10,0), 
	"ID_KOSIK" NUMBER(10,0), 
	"POCET" NUMBER(2,0) DEFAULT 1
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table LOGAKCE
--------------------------------------------------------

  CREATE TABLE "ST67009"."LOGAKCE" 
   (	"ID_LOG_AKCE" NUMBER(10,0), 
	"NAZEV" VARCHAR2(32 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table LOGS
--------------------------------------------------------

  CREATE TABLE "ST67009"."LOGS" 
   (	"ID_LOG" NUMBER(10,0), 
	"NAZEV_TABULKY" VARCHAR2(64 CHAR), 
	"DATUM" TIMESTAMP (0) WITH LOCAL TIME ZONE, 
	"NOVY_ZAZNAM" CLOB, 
	"STARY_ZAZNAM" CLOB, 
	"ID_LOG_AKCE" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" 
 LOB ("NOVY_ZAZNAM") STORE AS SECUREFILE (
  TABLESPACE "STUDENTI" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) 
 LOB ("STARY_ZAZNAM") STORE AS SECUREFILE (
  TABLESPACE "STUDENTI" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table MESTA
--------------------------------------------------------

  CREATE TABLE "ST67009"."MESTA" 
   (	"ID_MESTO" NUMBER(10,0), 
	"NAZEV" VARCHAR2(128 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table OBRAZKY
--------------------------------------------------------

  CREATE TABLE "ST67009"."OBRAZKY" 
   (	"ID_OBRAZEK" NUMBER(10,0), 
	"NAZEV_SOUBORU" VARCHAR2(255 BYTE), 
	"DATA" BLOB
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" 
 LOB ("DATA") STORE AS SECUREFILE (
  TABLESPACE "STUDENTI" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table OPRAVNENI
--------------------------------------------------------

  CREATE TABLE "ST67009"."OPRAVNENI" 
   (	"ID_OPRAVNENI" NUMBER(10,0), 
	"NAZEV" VARCHAR2(32 CHAR), 
	"UROVEN" NUMBER(1,0) DEFAULT 0
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table PSC
--------------------------------------------------------

  CREATE TABLE "ST67009"."PSC" 
   (	"ID_PSC" NUMBER(10,0), 
	"PSC" CHAR(5 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table STAVYOBJEDNAVEK
--------------------------------------------------------

  CREATE TABLE "ST67009"."STAVYOBJEDNAVEK" 
   (	"ID_STAV_OBJEDNAVKY" NUMBER(10,0), 
	"NAZEV" VARCHAR2(32 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table ULICE
--------------------------------------------------------

  CREATE TABLE "ST67009"."ULICE" 
   (	"ID_ULICE" NUMBER(10,0), 
	"NAZEV" VARCHAR2(128 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table UZIVATELE
--------------------------------------------------------

  CREATE TABLE "ST67009"."UZIVATELE" 
   (	"ID_UZIVATEL" NUMBER(10,0), 
	"EMAIL" VARCHAR2(256 CHAR), 
	"PW_HASH" CHAR(64 CHAR), 
	"SALT" CHAR(32 CHAR), 
	"ID_OPRAVNENI" NUMBER(10,0), 
	"ID_OBRAZEK" NUMBER(10,0), 
	"ID_ADRESA" NUMBER(10,0)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Table ZPUSOBYPLATEB
--------------------------------------------------------

  CREATE TABLE "ST67009"."ZPUSOBYPLATEB" 
   (	"ID_ZPUSOB_PLATBY" NUMBER(10,0), 
	"NAZEV" VARCHAR2(32 CHAR)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for View VIEW_ADRESY_ZKRATKY
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_ADRESY_ZKRATKY" ("ID_ADRESA", "ZKRATKA") AS 
  SELECT
    a.id_adresa,
    u.nazev || ' ' || a.cp || ', ' || p.psc || ' ' || m.nazev || ', Česká Republika' AS zkratka
FROM
    adresy a
JOIN
    ulice u ON a.id_ulice = u.id_ulice
JOIN
    mesta m ON a.id_mesto = m.id_mesto
JOIN
    psc p ON a.id_psc = p.id_psc
;
--------------------------------------------------------
--  DDL for View VIEW_CENY_KVETIN_PRI_OBJEDNANI
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_CENY_KVETIN_PRI_OBJEDNANI" ("ID_KOSIK", "ID_KVETINA", "CENA_ZA_KUS", "POCET") AS 
  SELECT
    kk.id_kosik,
    kk.id_kvetina,
    h.cena AS cena_za_kus,
    kk.pocet
FROM
    kvetinykosiky kk
JOIN
    (
        SELECT
            l.datum,
            JSON_VALUE(novy_zaznam, '$.id_kvetina' RETURNING NUMBER) AS id_kvetina,
            JSON_VALUE(novy_zaznam, '$.cena' RETURNING NUMBER) AS cena,
            ROW_NUMBER() OVER (
                PARTITION BY JSON_VALUE(novy_zaznam, '$.id_kvetina')
                ORDER BY l.datum DESC
            ) AS rn,
            ko.datum_vytvoreni
        FROM
            LOGS l
        CROSS JOIN
            kosiky ko
        WHERE
            UPPER(nazev_tabulky) = UPPER('Kvetiny')
            AND l.datum <= ko.datum_vytvoreni
    ) h ON h.id_kvetina = kk.id_kvetina AND h.rn = 1
;
--------------------------------------------------------
--  DDL for View VIEW_HISTORIE_CEN_KVETIN
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_HISTORIE_CEN_KVETIN" ("ID_KOSIK", "ID_KVETINA", "CENA_ZA_KUS", "DATUM_POSLEDNI_ZMENY_CENY", "POCET", "CELKOVA_CENA", "SLEVA") AS 
  SELECT
    kk.id_kosik,
    kk.id_kvetina,
    h.cena AS cena_za_kus,
    h.datum AS datum_posledni_zmeny_ceny,
    kk.pocet,
    ko.cena AS celkova_cena,
    ko.sleva
FROM
    kvetinykosiky kk
JOIN
    kosiky ko ON ko.id_kosik = kk.id_kosik
JOIN
    (
        SELECT
            l.datum,
            JSON_VALUE(novy_zaznam, '$.id_kvetina' RETURNING NUMBER) AS id_kvetina,
            JSON_VALUE(novy_zaznam, '$.cena' RETURNING NUMBER) AS cena,
            ROW_NUMBER() OVER (
                PARTITION BY JSON_VALUE(novy_zaznam, '$.id_kvetina')
                ORDER BY l.datum DESC
            ) AS rn,
            ko_inner.datum_vytvoreni
        FROM
            LOGS l
        CROSS JOIN
            kosiky ko_inner
        WHERE
            UPPER(nazev_tabulky) = UPPER('Kvetiny')
            AND l.datum <= ko_inner.datum_vytvoreni
    ) h ON h.id_kvetina = kk.id_kvetina AND h.rn = 1
;
--------------------------------------------------------
--  DDL for View VIEW_KATEGORIE_PODSTROM_KVETIN
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_KATEGORIE_PODSTROM_KVETIN" ("ID_KATEGORIE", "ID_KVETINA") AS 
  WITH RECURSIVE_CATEGORIES AS (
    SELECT 
        k.ID_KATEGORIE, 
        k.ID_NADRAZENE_KATEGORIE
    FROM 
        KATEGORIE k
    CONNECT BY PRIOR k.ID_KATEGORIE = k.ID_NADRAZENE_KATEGORIE
    START WITH k.ID_KATEGORIE IS NOT NULL
)
SELECT 
    rc.ID_KATEGORIE,
    kv.ID_KVETINA
FROM 
    RECURSIVE_CATEGORIES rc
JOIN 
    KVETINY kv ON rc.ID_KATEGORIE = kv.ID_KATEGORIE
;
--------------------------------------------------------
--  DDL for View VIEW_LOGS
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_LOGS" ("ID_LOG", "AKCE", "NAZEV_TABULKY", "DATUM_AKCE", "NOVY_ZAZNAM", "STARY_ZAZNAM") AS 
  select id_log, nazev as akce, upper(nazev_tabulky) as nazev_tabulky, datum as datum_akce, novy_zaznam, stary_zaznam
from logs 
join logakce using (id_log_akce) 
order by nazev_tabulky, datum, nazev
;
--------------------------------------------------------
--  DDL for View VIEW_OBJEDNAVKY_UZIVATELU
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_OBJEDNAVKY_UZIVATELU" ("ID_KVETINA", "ID_KOSIK", "CENA_ZA_KUS", "POCET", "NAZEV_KVETINY", "ID_OBRAZEK", "ID_KATEGORIE", "NAZEV_SOUBORU", "DATA", "NAZEV_KATEGORIE", "ID_UZIVATEL") AS 
  SELECT 
    c.id_kvetina as id_kvetina, c.id_kosik as id_kosik, c.cena_za_kus as cena_za_kus, c.pocet as pocet,
    k.nazev as nazev_kvetiny, k.id_obrazek as id_obrazek, k.id_kategorie as id_kategorie,
    o.nazev_souboru as nazev_souboru, o.data as data,
    kat.nazev as nazev_kategorie,
    ko.id_uzivatel as id_uzivatel
FROM
    view_historie_cen_kvetin c
JOIN
    kvetiny k ON k.id_kvetina = c.id_kvetina
JOIN
    kategorie kat ON kat.id_kategorie = k.id_kategorie
JOIN
    obrazky o ON o.id_obrazek = k.id_obrazek
JOIN
    kosiky ko ON ko.id_kosik = c.id_kosik
;
--------------------------------------------------------
--  DDL for View VIEW_SYS_KATALOG
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "ST67009"."VIEW_SYS_KATALOG" ("TABULKA", "SLOUPEC", "DATOVY_TYP") AS 
  select table_name as tabulka, column_name as sloupec, data_type as datovy_typ
from user_tables
join user_tab_columns using (table_name)
order by table_name, column_name
;
REM INSERTING into ST67009.ADRESY
SET DEFINE OFF;
Insert into ST67009.ADRESY (ID_ADRESA,CP,ID_MESTO,ID_ULICE,ID_PSC) values (39,107,48,31,28);
Insert into ST67009.ADRESY (ID_ADRESA,CP,ID_MESTO,ID_ULICE,ID_PSC) values (37,99,46,29,26);
Insert into ST67009.ADRESY (ID_ADRESA,CP,ID_MESTO,ID_ULICE,ID_PSC) values (38,957,47,30,27);
REM INSERTING into ST67009.DOTAZY
SET DEFINE OFF;
Insert into ST67009.DOTAZY (ID_DOTAZ,DATUM_PODANI,VEREJNY,ID_ODPOVIDAJICI_UZIVATEL) values (52,to_timestamp('07-DEC-25 01.35.10.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1,null);
Insert into ST67009.DOTAZY (ID_DOTAZ,DATUM_PODANI,VEREJNY,ID_ODPOVIDAJICI_UZIVATEL) values (55,to_timestamp('07-DEC-25 01.37.03.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1,32);
Insert into ST67009.DOTAZY (ID_DOTAZ,DATUM_PODANI,VEREJNY,ID_ODPOVIDAJICI_UZIVATEL) values (53,to_timestamp('07-DEC-25 01.35.26.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1,null);
Insert into ST67009.DOTAZY (ID_DOTAZ,DATUM_PODANI,VEREJNY,ID_ODPOVIDAJICI_UZIVATEL) values (54,to_timestamp('07-DEC-25 01.35.37.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1,null);
REM INSERTING into ST67009.KATEGORIE
SET DEFINE OFF;
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (29,'Bylinky',20);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (30,'Kořeninové rostliny',20);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (31,'Levandule',29);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (32,'Heřmánek',29);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (33,'Šafrán',30);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (34,'Vodní',21);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (35,'Bahenní',21);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (36,'Kosatce',35);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (37,'Lekníny',34);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (19,'Okrasné rostliny',null);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (20,'Léčivé a aromatické rostliny',null);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (21,'Vodní a bahenní rostliny',null);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (22,'Letničky',19);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (23,'Trvalky',19);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (24,'Růže',22);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (25,'Chryzantémy',22);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (26,'Tulipány',23);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (27,'Orchideje',23);
Insert into ST67009.KATEGORIE (ID_KATEGORIE,NAZEV,ID_NADRAZENE_KATEGORIE) values (28,'Lilie',23);
REM INSERTING into ST67009.KOSIKY
SET DEFINE OFF;
Insert into ST67009.KOSIKY (ID_KOSIK,DATUM_VYTVORENI,CENA,SLEVA,ID_UZIVATEL,ID_STAV_OBJEDNAVKY,ID_ZPUSOB_PLATBY) values (96,to_timestamp('07-DEC-25 01.32.25.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2100,0,33,4,1);
Insert into ST67009.KOSIKY (ID_KOSIK,DATUM_VYTVORENI,CENA,SLEVA,ID_UZIVATEL,ID_STAV_OBJEDNAVKY,ID_ZPUSOB_PLATBY) values (95,to_timestamp('07-DEC-25 01.29.01.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1390,0,33,3,3);
REM INSERTING into ST67009.KVETINY
SET DEFINE OFF;
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (7,'Chryzantéma Indická',200,25,15);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (9,'Lilie Zlatohlavá',250,28,19);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (11,'Heřmánek pravý',200,32,14);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (14,'Leknín bíly',400,34,17);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (16,'Můrovec',480,27,20);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (8,'Růže Velkokvětá',250,24,21);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (12,'Levandule Lékařská',120,31,18);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (13,'Šafrán Setý',120,33,22);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (10,'Tulipán Zahradní',150,26,23);
Insert into ST67009.KVETINY (ID_KVETINA,NAZEV,CENA,ID_KATEGORIE,ID_OBRAZEK) values (15,'Kosatec žlutý',350,35,16);
REM INSERTING into ST67009.KVETINYKOSIKY
SET DEFINE OFF;
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (12,96,1);
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (9,96,4);
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (8,96,2);
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (16,96,1);
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (12,95,2);
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (11,95,4);
Insert into ST67009.KVETINYKOSIKY (ID_KVETINA,ID_KOSIK,POCET) values (15,95,1);
REM INSERTING into ST67009.LOGAKCE
SET DEFINE OFF;
Insert into ST67009.LOGAKCE (ID_LOG_AKCE,NAZEV) values (1,'Insert');
Insert into ST67009.LOGAKCE (ID_LOG_AKCE,NAZEV) values (2,'Update');
Insert into ST67009.LOGAKCE (ID_LOG_AKCE,NAZEV) values (3,'Delete');
REM INSERTING into ST67009.LOGS
SET DEFINE OFF;
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (473,'mesta',to_timestamp('07-DEC-25 12.30.59.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (474,'UZIVATELE',to_timestamp('07-DEC-25 12.30.59.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (475,'UZIVATELE',to_timestamp('07-DEC-25 12.30.59.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (476,'UZIVATELE',to_timestamp('07-DEC-25 12.30.59.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (477,'UZIVATELE',to_timestamp('07-DEC-25 01.09.24.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (478,'UZIVATELE',to_timestamp('07-DEC-25 01.09.24.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (479,'UZIVATELE',to_timestamp('07-DEC-25 01.09.24.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (480,'KVETINY',to_timestamp('07-DEC-25 01.19.21.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (481,'KVETINY',to_timestamp('07-DEC-25 01.19.44.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (482,'KVETINY',to_timestamp('07-DEC-25 01.20.05.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (483,'KVETINY',to_timestamp('07-DEC-25 01.20.27.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (484,'KVETINY',to_timestamp('07-DEC-25 01.20.48.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (485,'KVETINY',to_timestamp('07-DEC-25 01.21.23.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (486,'KVETINY',to_timestamp('07-DEC-25 01.21.51.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (487,'KVETINY',to_timestamp('07-DEC-25 01.22.17.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (488,'KVETINY',to_timestamp('07-DEC-25 01.22.37.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (489,'KVETINY',to_timestamp('07-DEC-25 01.25.37.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (490,'mesta',to_timestamp('07-DEC-25 01.27.34.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (495,'mesta',to_timestamp('07-DEC-25 01.30.59.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (499,'KOSIKY',to_timestamp('07-DEC-25 01.32.34.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (491,'UZIVATELE',to_timestamp('07-DEC-25 01.27.35.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (494,'KOSIKY',to_timestamp('07-DEC-25 01.29.54.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (497,'KOSIKY',to_timestamp('07-DEC-25 01.32.25.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (498,'KOSIKY',to_timestamp('07-DEC-25 01.32.25.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (492,'KOSIKY',to_timestamp('07-DEC-25 01.29.01.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),1);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (493,'KOSIKY',to_timestamp('07-DEC-25 01.29.01.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (496,'UZIVATELE',to_timestamp('07-DEC-25 01.31.00.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
Insert into ST67009.LOGS (ID_LOG,NAZEV_TABULKY,DATUM,ID_LOG_AKCE) values (500,'KOSIKY',to_timestamp('07-DEC-25 01.33.24.000000000 PM','DD-MON-RR HH.MI.SSXFF AM'),2);
REM INSERTING into ST67009.MESTA
SET DEFINE OFF;
Insert into ST67009.MESTA (ID_MESTO,NAZEV) values (46,'Jaroměř');
Insert into ST67009.MESTA (ID_MESTO,NAZEV) values (48,'Praha');
Insert into ST67009.MESTA (ID_MESTO,NAZEV) values (47,'Pardubice');
REM INSERTING into ST67009.OBRAZKY
SET DEFINE OFF;
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (15,'chryzantema_indicka.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (22,'safran_sety.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (20,'murovec.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (23,'tulipan_zahradni.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (17,'leknin_bily.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (6,'default_avatar.png');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (21,'ruze_velkokveta.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (14,'hermanek_pravy.JPG');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (18,'levandule_lekarska.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (16,'kosatec_zluty.jpg');
Insert into ST67009.OBRAZKY (ID_OBRAZEK,NAZEV_SOUBORU) values (19,'lilie_zlatohlava.jpg');
REM INSERTING into ST67009.OPRAVNENI
SET DEFINE OFF;
Insert into ST67009.OPRAVNENI (ID_OPRAVNENI,NAZEV,UROVEN) values (1,'Uživatel',0);
Insert into ST67009.OPRAVNENI (ID_OPRAVNENI,NAZEV,UROVEN) values (2,'Zaměstnanec',1);
Insert into ST67009.OPRAVNENI (ID_OPRAVNENI,NAZEV,UROVEN) values (3,'Administrátor',2);
REM INSERTING into ST67009.PSC
SET DEFINE OFF;
Insert into ST67009.PSC (ID_PSC,PSC) values (26,'51025');
Insert into ST67009.PSC (ID_PSC,PSC) values (28,'51532');
Insert into ST67009.PSC (ID_PSC,PSC) values (27,'53012');
REM INSERTING into ST67009.STAVYOBJEDNAVEK
SET DEFINE OFF;
Insert into ST67009.STAVYOBJEDNAVEK (ID_STAV_OBJEDNAVKY,NAZEV) values (1,'Čeká na zaplacení');
Insert into ST67009.STAVYOBJEDNAVEK (ID_STAV_OBJEDNAVKY,NAZEV) values (2,'Vyřízena');
Insert into ST67009.STAVYOBJEDNAVEK (ID_STAV_OBJEDNAVKY,NAZEV) values (3,'Na cestě');
Insert into ST67009.STAVYOBJEDNAVEK (ID_STAV_OBJEDNAVKY,NAZEV) values (4,'Zrušena');
REM INSERTING into ST67009.ULICE
SET DEFINE OFF;
Insert into ST67009.ULICE (ID_ULICE,NAZEV) values (29,'Květinářská');
Insert into ST67009.ULICE (ID_ULICE,NAZEV) values (30,'Erno Košťála');
Insert into ST67009.ULICE (ID_ULICE,NAZEV) values (31,'Pražská');
REM INSERTING into ST67009.UZIVATELE
SET DEFINE OFF;
Insert into ST67009.UZIVATELE (ID_UZIVATEL,EMAIL,PW_HASH,SALT,ID_OPRAVNENI,ID_OBRAZEK,ID_ADRESA) values (31,'admin@kvetinka.cz','459C2B4371DDDC1CBD7853476505B959F66DBFB22B91FAD4FD857B6DE0D2C346','2TLJ3OWMF8XHJJQE2SN5HN0LK2O0CF5A',3,6,37);
Insert into ST67009.UZIVATELE (ID_UZIVATEL,EMAIL,PW_HASH,SALT,ID_OPRAVNENI,ID_OBRAZEK,ID_ADRESA) values (32,'frantisek.boura@kvetinka.cz','8062668AC3A8264754C17A9714F985A94EDCA4DC5E49F53F3829035DD777F431','7SR6GDWV6YYXAIQJDW09JLFMW9KG42WN',2,6,38);
Insert into ST67009.UZIVATELE (ID_UZIVATEL,EMAIL,PW_HASH,SALT,ID_OPRAVNENI,ID_OBRAZEK,ID_ADRESA) values (33,'uzivatel@email.cz','BE259C29789427436C283D2DDBC56F4E02479528511D0A0E6FAD7FDDC0271A19','0OOZXM98RM2R6Q4XZP9W0LX41CNKGTI6',1,6,39);
REM INSERTING into ST67009.ZPUSOBYPLATEB
SET DEFINE OFF;
Insert into ST67009.ZPUSOBYPLATEB (ID_ZPUSOB_PLATBY,NAZEV) values (1,'Kartou');
Insert into ST67009.ZPUSOBYPLATEB (ID_ZPUSOB_PLATBY,NAZEV) values (2,'Převodem');
Insert into ST67009.ZPUSOBYPLATEB (ID_ZPUSOB_PLATBY,NAZEV) values (3,'Google Pay');
Insert into ST67009.ZPUSOBYPLATEB (ID_ZPUSOB_PLATBY,NAZEV) values (4,'Apple Pay');
--------------------------------------------------------
--  DDL for Index PSC_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."PSC_PK" ON "ST67009"."PSC" ("ID_PSC") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index RELATION_25_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."RELATION_25_PK" ON "ST67009"."KVETINYKOSIKY" ("ID_KVETINA", "ID_KOSIK") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index STAVYOBJEDNAVEK_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."STAVYOBJEDNAVEK_PK" ON "ST67009"."STAVYOBJEDNAVEK" ("ID_STAV_OBJEDNAVKY") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index ADRESY_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."ADRESY_PK" ON "ST67009"."ADRESY" ("ID_ADRESA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index DOTAZY_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."DOTAZY_PK" ON "ST67009"."DOTAZY" ("ID_DOTAZ") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index KATEGORIE_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."KATEGORIE_PK" ON "ST67009"."KATEGORIE" ("ID_KATEGORIE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index KOSIKY_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."KOSIKY_PK" ON "ST67009"."KOSIKY" ("ID_KOSIK") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index KVETINY_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."KVETINY_PK" ON "ST67009"."KVETINY" ("ID_KVETINA") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index LOGAKCE_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."LOGAKCE_PK" ON "ST67009"."LOGAKCE" ("ID_LOG_AKCE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index LOG_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."LOG_PK" ON "ST67009"."LOGS" ("ID_LOG") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index MESTA_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."MESTA_PK" ON "ST67009"."MESTA" ("ID_MESTO") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index OBRAZKY_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."OBRAZKY_PK" ON "ST67009"."OBRAZKY" ("ID_OBRAZEK") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index OPRAVNENI_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."OPRAVNENI_PK" ON "ST67009"."OPRAVNENI" ("ID_OPRAVNENI") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index ULICE_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."ULICE_PK" ON "ST67009"."ULICE" ("ID_ULICE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index UZIVATELE_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."UZIVATELE_PK" ON "ST67009"."UZIVATELE" ("ID_UZIVATEL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Index ZPUSOBYPLATEB_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "ST67009"."ZPUSOBYPLATEB_PK" ON "ST67009"."ZPUSOBYPLATEB" ("ID_ZPUSOB_PLATBY") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI" ;
--------------------------------------------------------
--  DDL for Trigger TRG_KOSIKY_CENA_CHK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."TRG_KOSIKY_CENA_CHK" 
BEFORE INSERT OR UPDATE OF cena ON KOSIKY
FOR EACH ROW
BEGIN
  IF :NEW.cena IS NULL
     OR :NEW.cena < 0
     OR :NEW.cena > 999999999.99
  THEN
    RAISE_APPLICATION_ERROR(
      -20050,
      'Cena objednavky musi byt v rozsahu 0 az 999999999.99.'
    );
  END IF;
END;

/
ALTER TRIGGER "ST67009"."TRG_KOSIKY_CENA_CHK" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_KOSIKY_DATUM_NE_MINULOST
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."TRG_KOSIKY_DATUM_NE_MINULOST" 
BEFORE INSERT OR UPDATE OF datum_vytvoreni ON KOSIKY
FOR EACH ROW
BEGIN
  -- nesmí být v minulosti vůči aktuálnímu času
  IF :NEW.datum_vytvoreni < SYSTIMESTAMP - INTERVAL '5' SECOND THEN
    RAISE_APPLICATION_ERROR(
      -20030,
      'Datum podani objednavky nesmi byt driv, nez aktualni cas.'
    );
  END IF;
END;
/
ALTER TRIGGER "ST67009"."TRG_KOSIKY_DATUM_NE_MINULOST" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_KVETINY_CENA_CHK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."TRG_KVETINY_CENA_CHK" 
BEFORE INSERT OR UPDATE OF cena ON KVETINY
FOR EACH ROW
BEGIN
  IF :NEW.cena IS NULL
     OR :NEW.cena < 0
     OR :NEW.cena > 999999999.99
  THEN
    RAISE_APPLICATION_ERROR(
      -20040,
      'Cena kvetiny musi byt v rozsahu 0 az 999999999.99.'
    );
  END IF;
END;

/
ALTER TRIGGER "ST67009"."TRG_KVETINY_CENA_CHK" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_OPRAVNENI_UROVEN_CHK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."TRG_OPRAVNENI_UROVEN_CHK" 
BEFORE INSERT OR UPDATE OF uroven ON OPRAVNENI
FOR EACH ROW
BEGIN
  IF :NEW.uroven IS NULL
     OR :NEW.uroven < 0
     OR :NEW.uroven > 3
  THEN
    RAISE_APPLICATION_ERROR(
      -20020,
      'Uroven opravneni musi byt v rozsahu 0–3.'
    );
  END IF;
END;

/
ALTER TRIGGER "ST67009"."TRG_OPRAVNENI_UROVEN_CHK" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_ADRESY_ID_ADRESA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_ADRESY_ID_ADRESA" 
BEFORE INSERT ON Adresy 
FOR EACH ROW 
 WHEN (NEW.id_adresa IS NULL) BEGIN 
    :NEW.id_adresa := s_Adresy_id_adresa.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_ADRESY_ID_ADRESA" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_DOTAZY_ID_DOTAZ
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_DOTAZY_ID_DOTAZ" 
BEFORE INSERT ON Dotazy 
FOR EACH ROW 
 WHEN (NEW.id_dotaz IS NULL) BEGIN 
    :NEW.id_dotaz := s_Dotazy_id_dotaz.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_DOTAZY_ID_DOTAZ" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_KATEGORIE_ID_KATEGORIE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_KATEGORIE_ID_KATEGORIE" 
BEFORE INSERT ON Kategorie 
FOR EACH ROW 
 WHEN (NEW.id_kategorie IS NULL) BEGIN 
    :NEW.id_kategorie := s_Kategorie_id_kategorie.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_KATEGORIE_ID_KATEGORIE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_KOSIKY_ID_KOSIK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_KOSIKY_ID_KOSIK" 
BEFORE INSERT ON Kosiky 
FOR EACH ROW 
 WHEN (NEW.id_kosik IS NULL) BEGIN 
    :NEW.id_kosik := s_Kosiky_id_kosik.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_KOSIKY_ID_KOSIK" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_KVETINYKOSIKY_ID_KVETINA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_KVETINYKOSIKY_ID_KVETINA" 
BEFORE INSERT ON KvetinyKosiky 
FOR EACH ROW 
 WHEN (NEW.id_kvetina IS NULL) BEGIN 
    :NEW.id_kvetina := s_KvetinyKosiky_id_kvetina.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_KVETINYKOSIKY_ID_KVETINA" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_KVETINY_ID_KVETINA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_KVETINY_ID_KVETINA" 
BEFORE INSERT ON Kvetiny 
FOR EACH ROW 
 WHEN (NEW.id_kvetina IS NULL) BEGIN 
    :NEW.id_kvetina := s_Kvetiny_id_kvetina.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_KVETINY_ID_KVETINA" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_LOGAKCE_ID_LOG_AKCE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_LOGAKCE_ID_LOG_AKCE" 
BEFORE INSERT ON LogAkce 
FOR EACH ROW 
 WHEN (NEW.id_log_akce IS NULL) BEGIN 
    :NEW.id_log_akce := s_LogAkce_id_log_akce.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_LOGAKCE_ID_LOG_AKCE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_LOG_ID_LOG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_LOG_ID_LOG" 
BEFORE INSERT ON "LOGS" 
FOR EACH ROW 
 WHEN (NEW.id_log IS NULL) BEGIN 
    :NEW.id_log := s_Log_id_log.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_LOG_ID_LOG" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_LOG_KOSIKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_LOG_KOSIKY" 
AFTER INSERT OR UPDATE OR DELETE ON Kosiky
FOR EACH ROW
DECLARE
    v_id_log_akce logakce.id_log_akce%TYPE;
   v_json_data_novy logs.novy_zaznam%TYPE;
   v_json_data_stary logs.stary_zaznam%TYPE DEFAULT NULL;
BEGIN
    CASE
        WHEN INSERTING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Insert';
            v_json_data_novy := JSON_OBJECT(
                'id_kosik' VALUE :NEW.id_kosik,
                'datum_vytvoreni' VALUE TO_CHAR(:NEW.datum_vytvoreni, 'YYYY-MM-DD HH24:MI:SS'),
                'cena' VALUE :NEW.cena,
                'sleva' VALUE :NEW.sleva,
                'id_uzivatel' VALUE :NEW.id_uzivatel,
                'id_stav_objednavky' VALUE :NEW.id_stav_objednavky,
                'id_zpusob_platby' VALUE :NEW.id_zpusob_platby
            );
        WHEN UPDATING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Update';
            v_json_data_stary := JSON_OBJECT(
                'id_kosik' VALUE :OLD.id_kosik,
                'cena' VALUE :OLD.cena,
                'sleva' VALUE :OLD.sleva,
                'id_stav_objednavky' VALUE :OLD.id_stav_objednavky
            );
            v_json_data_novy := JSON_OBJECT(
                'id_kosik' VALUE :NEW.id_kosik,
                'cena' VALUE :NEW.cena,
                'sleva' VALUE :NEW.sleva,
                'id_stav_objednavky' VALUE :OLD.id_stav_objednavky
            );
        WHEN DELETING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Delete';
            v_json_data_novy := JSON_OBJECT(
                'id_kosik' VALUE :OLD.id_kosik,
                'datum_vytvoreni' VALUE TO_CHAR(:OLD.datum_vytvoreni, 'YYYY-MM-DD HH24:MI:SS'),
                'cena' VALUE :OLD.cena,
                'sleva' VALUE :OLD.sleva,
                'id_uzivatel' VALUE :OLD.id_uzivatel,
                'id_stav_objednavky' VALUE :OLD.id_stav_objednavky,
                'id_zpusob_platby' VALUE :OLD.id_zpusob_platby
            );
    END CASE;

    INSERT INTO logs (nazev_tabulky, datum, novy_zaznam, stary_zaznam, id_log_akce)
    VALUES ('KOSIKY', CURRENT_TIMESTAMP, v_json_data_novy, v_json_data_stary, v_id_log_akce);
END;
/
ALTER TRIGGER "ST67009"."T_LOG_KOSIKY" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_LOG_KVETINY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_LOG_KVETINY" 
AFTER INSERT OR UPDATE OR DELETE ON Kvetiny
FOR EACH ROW
DECLARE
    v_id_log_akce logakce.id_log_akce%TYPE;
   v_json_data_novy logs.novy_zaznam%TYPE;
   v_json_data_stary logs.stary_zaznam%TYPE DEFAULT NULL;
BEGIN
    CASE
        WHEN INSERTING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Insert';
            v_json_data_novy := JSON_OBJECT(
                'id_kvetina' VALUE :NEW.id_kvetina,
                'nazev' VALUE :NEW.nazev,
                'cena' VALUE :NEW.cena
            );
        WHEN UPDATING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Update';
            v_json_data_stary := JSON_OBJECT(
                'id_kvetina' VALUE :OLD.id_kvetina,
                'nazev' VALUE :OLD.nazev,
                'cena' VALUE :OLD.cena
            );
            v_json_data_novy := JSON_OBJECT(
                'id_kvetina' VALUE :NEW.id_kvetina,
                'nazev' VALUE :NEW.nazev,
                'cena' VALUE :NEW.cena
            );
        WHEN DELETING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Delete';
            v_json_data_novy := JSON_OBJECT(
                'id_kvetina' VALUE :OLD.id_kvetina,
                'nazev' VALUE :OLD.nazev,
                'cena' VALUE :OLD.cena
            );
    END CASE;

    INSERT INTO logs (nazev_tabulky, datum, novy_zaznam, stary_zaznam, id_log_akce)
    VALUES ('KVETINY', CURRENT_TIMESTAMP, v_json_data_novy, v_json_data_stary, v_id_log_akce);
END;

/
ALTER TRIGGER "ST67009"."T_LOG_KVETINY" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_LOG_MESTA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_LOG_MESTA" AFTER
   INSERT OR UPDATE OR DELETE ON mesta
   FOR EACH ROW
DECLARE
   v_id_log_akce logakce.id_log_akce%TYPE;
   v_json_data_novy logs.novy_zaznam%TYPE;
   v_json_data_stary logs.stary_zaznam%TYPE DEFAULT NULL;
BEGIN
   CASE
      WHEN INSERTING THEN
         SELECT id_log_akce
         INTO v_id_log_akce
         FROM logakce
         WHERE nazev = 'Insert';

         v_json_data_novy := JSON_OBJECT(
            'id_mesto' VALUE :NEW.id_mesto,
            'nazev'    VALUE :NEW.nazev
         );
      WHEN UPDATING THEN
         SELECT id_log_akce
         INTO v_id_log_akce
         FROM logakce
         WHERE nazev = 'Update';

         v_json_data_stary := JSON_OBJECT(
            'id_mesto' VALUE :OLD.id_mesto,
            'nazev'    VALUE :OLD.nazev
         );

         v_json_data_novy := JSON_OBJECT(
            'id_mesto' VALUE :NEW.id_mesto,
            'nazev'    VALUE :NEW.nazev
         );
      WHEN DELETING THEN
         SELECT id_log_akce
         INTO v_id_log_akce
         FROM logakce
         WHERE nazev = 'Delete';

         v_json_data_novy := JSON_OBJECT(
            'id_mesto' VALUE :OLD.id_mesto,
            'nazev'    VALUE :OLD.nazev
         );
   END CASE;

   INSERT INTO logs(nazev_tabulky, datum, novy_zaznam, stary_zaznam, id_log_akce)
   VALUES ('mesta', CURRENT_TIMESTAMP, v_json_data_novy, v_json_data_stary, v_id_log_akce);
END;

/
ALTER TRIGGER "ST67009"."T_LOG_MESTA" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_LOG_UZIVATELE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_LOG_UZIVATELE" 
AFTER INSERT OR UPDATE OR DELETE ON Uzivatele
FOR EACH ROW
DECLARE
    v_id_log_akce logakce.id_log_akce%TYPE;
   v_json_data_novy logs.novy_zaznam%TYPE;
   v_json_data_stary logs.stary_zaznam%TYPE DEFAULT NULL;
BEGIN
    CASE
        WHEN INSERTING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Insert';
            v_json_data_novy := JSON_OBJECT(
                'id_uzivatel' VALUE :NEW.id_uzivatel,
                'email' VALUE :NEW.email,
                'pw_hash' VALUE :NEW.pw_hash,
                'salt' VALUE :NEW.salt
            );
        WHEN UPDATING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Update';
            v_json_data_stary := JSON_OBJECT(
                'id_uzivatel' VALUE :OLD.id_uzivatel,
                'email' VALUE :OLD.email
            );
            v_json_data_novy := JSON_OBJECT(
                'id_uzivatel' VALUE :NEW.id_uzivatel,
                'email' VALUE :NEW.email
            );
        WHEN DELETING THEN
            SELECT id_log_akce INTO v_id_log_akce FROM LogAkce WHERE nazev = 'Delete';
            v_json_data_novy := JSON_OBJECT(
                'id_uzivatel' VALUE :OLD.id_uzivatel,
                'email' VALUE :OLD.email
            );
    END CASE;

    INSERT INTO logs (nazev_tabulky, datum, novy_zaznam, stary_zaznam, id_log_akce)
    VALUES ('UZIVATELE', CURRENT_TIMESTAMP, v_json_data_novy, v_json_data_stary, v_id_log_akce);
END;

/
ALTER TRIGGER "ST67009"."T_LOG_UZIVATELE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_MESTA_ID_MESTO
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_MESTA_ID_MESTO" 
BEFORE INSERT ON Mesta 
FOR EACH ROW 
 WHEN (NEW.id_mesto IS NULL) BEGIN 
    :NEW.id_mesto := s_Mesta_id_mesto.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_MESTA_ID_MESTO" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_OBRAZKY_ID_OBRAZEK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_OBRAZKY_ID_OBRAZEK" 
BEFORE INSERT ON Obrazky 
FOR EACH ROW 
 WHEN (NEW.id_obrazek IS NULL) BEGIN 
    :NEW.id_obrazek := s_Obrazky_id_obrazek.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_OBRAZKY_ID_OBRAZEK" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_OPRAVNENI_ID_OPRAVNENI
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_OPRAVNENI_ID_OPRAVNENI" 
BEFORE INSERT ON Opravneni 
FOR EACH ROW 
 WHEN (NEW.id_opravneni IS NULL) BEGIN 
    :NEW.id_opravneni := s_Opravneni_id_opravneni.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_OPRAVNENI_ID_OPRAVNENI" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_PSC_ID_PSC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_PSC_ID_PSC" 
BEFORE INSERT ON PSC 
FOR EACH ROW 
 WHEN (NEW.id_psc IS NULL) BEGIN 
    :NEW.id_psc := s_PSC_id_psc.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_PSC_ID_PSC" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_STAVYOBJEDNAVEK_ID_STAV_OBJEDNAVKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_STAVYOBJEDNAVEK_ID_STAV_OBJEDNAVKY" 
BEFORE INSERT ON StavyObjednavek 
FOR EACH ROW 
 WHEN (NEW.id_stav_objednavky IS NULL) BEGIN 
    :NEW.id_stav_objednavky := s_StavyObjednavek_id_stav_objednavky.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_STAVYOBJEDNAVEK_ID_STAV_OBJEDNAVKY" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_ULICE_ID_ULICE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_ULICE_ID_ULICE" 
BEFORE INSERT ON Ulice 
FOR EACH ROW 
 WHEN (NEW.id_ulice IS NULL) BEGIN 
    :NEW.id_ulice := s_Ulice_id_ulice.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_ULICE_ID_ULICE" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_UZIVATELE_ID_UZIVATEL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_UZIVATELE_ID_UZIVATEL" 
BEFORE INSERT ON Uzivatele 
FOR EACH ROW 
 WHEN (NEW.id_uzivatel IS NULL) BEGIN 
    :NEW.id_uzivatel := s_Uzivatele_id_uzivatel.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_UZIVATELE_ID_UZIVATEL" ENABLE;
--------------------------------------------------------
--  DDL for Trigger T_ZPUSOBYPLATEB_ID_ZPUSOB_PLATBY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "ST67009"."T_ZPUSOBYPLATEB_ID_ZPUSOB_PLATBY" 
BEFORE INSERT ON ZpusobyPlateb 
FOR EACH ROW 
 WHEN (NEW.id_zpusob_platby IS NULL) BEGIN 
    :NEW.id_zpusob_platby := s_ZpusobyPlateb_id_zpusob_platby.NEXTVAL; 
END;

/
ALTER TRIGGER "ST67009"."T_ZPUSOBYPLATEB_ID_ZPUSOB_PLATBY" ENABLE;
--------------------------------------------------------
--  DDL for Procedure DELETE_SCRIPT
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ST67009"."DELETE_SCRIPT" (p_schema IN VARCHAR2)
AS
    CURSOR c_script IS
        SELECT 'DROP TABLE ' || owner || '.' || table_name || ' CASCADE CONSTRAINTS;' 
        FROM all_tables 
        WHERE UPPER(owner) = UPPER(p_schema)
        ORDER BY table_name ASC;
    i_script_row        VARCHAR2(500);
BEGIN
    OPEN c_script;
    LOOP
        FETCH c_script INTO i_script_row;
        EXIT WHEN c_script%NOTFOUND;
        DBMS_OUTPUT.PUT_LINE(i_script_row);
    END LOOP;
    CLOSE c_script;
END;

/
--------------------------------------------------------
--  DDL for Procedure PROC_PODAT_OBJEDNAVKU
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ST67009"."PROC_PODAT_OBJEDNAVKU" (
    p_id_kosik         IN  KOSIKY.ID_KOSIK%TYPE,
    p_id_uzivatel      IN  UZIVATELE.ID_UZIVATEL%TYPE,
    p_id_zpusob_platby IN  ZPUSOBYPLATEB.ID_ZPUSOB_PLATBY%TYPE,
    p_cena_final       OUT NUMBER,
    p_sleva_pct        OUT NUMBER
)
AS
    -- konstanty a proměnné
    c_nazev_stavu_1   CONSTANT VARCHAR2(64) := 'ČEKÁ NA ZAPLACENÍ';
    c_nazev_stavu_2   CONSTANT VARCHAR2(64) := 'CEKA NA ZAPLACENI'; -- fallback bez diakritiky

    v_id_stav     STAVYOBJEDNAVEK.ID_STAV_OBJEDNAVKY%TYPE;
    v_cena_bez    NUMBER := 0;
    v_pocet_obj   NUMBER := 0;

    -- vlastní chyby
    e_kosik_neexistuje EXCEPTION;
    PRAGMA EXCEPTION_INIT(e_kosik_neexistuje, -20011);

    e_stav_chybi EXCEPTION;
    PRAGMA EXCEPTION_INIT(e_stav_chybi, -20012);
BEGIN

    -- 1) zjisti ID stavu "Čeká na zaplacení"
    SELECT id_stav_objednavky
      INTO v_id_stav
      FROM STAVYOBJEDNAVEK
     WHERE UPPER(nazev) IN (c_nazev_stavu_1, c_nazev_stavu_2)
     FETCH FIRST 1 ROWS ONLY;

    -- 2) spočti cenu z položek košíku
    SELECT NVL(SUM(kv.cena * kk.pocet), 0)
      INTO v_cena_bez
      FROM KVETINYKOSIKY kk
      JOIN KVETINY kv ON kv.id_kvetina = kk.id_kvetina
     WHERE kk.id_kosik = p_id_kosik;

    -- 3) spočti, kolikátá je to objednávka (každá 5. má 10 %)
    SELECT COUNT(*) INTO v_pocet_obj
      FROM KOSIKY
     WHERE id_uzivatel = p_id_uzivatel
       AND datum_vytvoreni IS NOT NULL;  -- počítáme už „podané“ košíky

    p_sleva_pct := CASE WHEN MOD(v_pocet_obj + 1, 5) = 0 THEN 10 ELSE 0 END;

    -- 4) spočti finální cenu
    p_cena_final := ROUND(v_cena_bez * (1 - (p_sleva_pct/100)), 2);

    -- 5) ulož do košíku „podání objednávky“
    UPDATE KOSIKY
       SET datum_vytvoreni    = SYSTIMESTAMP,
           cena               = p_cena_final,
           sleva              = p_sleva_pct,
           id_uzivatel        = p_id_uzivatel,
           id_stav_objednavky = v_id_stav,
           id_zpusob_platby   = p_id_zpusob_platby
     WHERE id_kosik = p_id_kosik;

    IF SQL%ROWCOUNT = 0 THEN
        RAISE_APPLICATION_ERROR(-20011, 'Košík (objednávka) #'||p_id_kosik||' nebyl aktualizován.');
    END IF;

    COMMIT;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        RAISE_APPLICATION_ERROR(-20012, 'Stav "Čeká na zaplacení" není v STAVYOBJEDNAVEK.');
    WHEN OTHERS THEN
        ROLLBACK;
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure PROC_ZISKEJ_KVETINY_V_HIERARCHII
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ST67009"."PROC_ZISKEJ_KVETINY_V_HIERARCHII" (
    p_id_nadrazena_kat IN KATEGORIE.ID_KATEGORIE%TYPE,
    p_kvetiny_cursor OUT SYS_REFCURSOR
)
AS
BEGIN
    -- Otevření kurzoru, který vrací květiny
    OPEN p_kvetiny_cursor FOR
        SELECT
            k.ID_KVETINA,
            k.NAZEV AS nazev_kvetiny,
            k.CENA,
            k.ID_KATEGORIE,
            kat.NAZEV AS nazev_kategorie
        FROM
            KVETINY k
        JOIN 
            KATEGORIE kat ON k.ID_KATEGORIE = kat.ID_KATEGORIE
        WHERE
            -- Klíčová část: Získání ID kategorií v hierarchii a použití IN
            k.ID_KATEGORIE IN (
                SELECT
                    ID_KATEGORIE
                FROM
                    KATEGORIE
                START WITH
                    ID_KATEGORIE = p_id_nadrazena_kat -- Začíná od kořenové kategorie
                CONNECT BY NOCYCLE
                    PRIOR ID_KATEGORIE = ID_NADRAZENE_KATEGORIE
            );
END;

/
--------------------------------------------------------
--  DDL for Procedure PRODLUZ_VARCHAR
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "ST67009"."PRODLUZ_VARCHAR" (
    p_tabulka IN VARCHAR2,
    p_o_kolik IN NUMBER
)
AS
    i_sloupce VARCHAR2(2000);
    i_prikaz  VARCHAR(2500);
    i_pocet NUMBER DEFAULT 0;
BEGIN
    FOR X IN (
        SELECT column_name, data_length FROM user_tab_columns
        WHERE UPPER(table_name) = UPPER(p_tabulka) AND data_type = 'VARCHAR2'
    )
    LOOP
        i_sloupce := i_sloupce || x.column_name || ' ' || 'VARCHAR2(' ||
            TO_CHAR(x.data_length + p_o_kolik) || '),';
        i_pocet := i_pocet + 1;
    END LOOP;

    if i_pocet > 0 THEN
        i_prikaz := 'ALTER TABLE ' || p_tabulka || ' MODIFY(' ||
            RTRIM(i_sloupce, ',') || ')';
        DBMS_OUTPUT.PUT_LINE(i_prikaz);
        DBMS_OUTPUT.PUT_LINE('modifikovano sloupcu: ' || i_pocet);
    END IF;
END PRODLUZ_VARCHAR;

/
--------------------------------------------------------
--  DDL for Package DATUMY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."DATUMY" 
AS
    FUNCTION datumy_rozdil(
        datum_od DATE, 
        datum_do DATE, 
        typ CHAR
    )
    RETURN NUMBER;

    FUNCTION pracovni_den(
        datum DATE
    )
    RETURN NUMBER;

    FUNCTION den_v_mesici(
        datum DATE,
        prvni NUMBER
    ) 
    RETURN DATE;
END DATUMY;

/
--------------------------------------------------------
--  DDL for Package PCK_ADMINISTRATIVA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_ADMINISTRATIVA" 
AS  
    PROCEDURE PROC_SMAZ_STARE_DOTAZY(
        p_starsi_nez            IN DATE,
        
        o_pocet_smazanych       OUT NUMBER
    );

    PROCEDURE PROC_PODEJ_OBJEDNAVKU(
        p_id_uzivatel           IN UZIVATELE.id_uzivatel%TYPE,
        p_id_zpusob_platby      IN ZPUSOBYPLATEB.id_zpusob_platby%TYPE,
        p_objednane_kvetiny     IN T_KVETINA_KOSIK_LIST,

        o_novy_kosik_id         OUT KOSIKY.id_kosik%TYPE
    );

    FUNCTION FUNC_NAROK_NA_SLEVU(
        p_id_uzivatel           IN UZIVATELE.id_uzivatel%TYPE
    )
    RETURN NUMBER;

    PROCEDURE PROC_PRIDEJ_DOTAZ(
        p_text IN CLOB,
        
        o_id_dotaz OUT NUMBER,
        o_status OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_ODPOVED_NA_DOTAZ(
        p_id_dotaz IN NUMBER,
        p_id_odpovidajici_uzivatel IN NUMBER,
        p_odpoved IN CLOB,
        
        o_id_dotaz OUT NUMBER,
        o_status OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

END PCK_ADMINISTRATIVA;

/
--------------------------------------------------------
--  DDL for Package PCK_ADRESY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_ADRESY" 
AS
    
    PROCEDURE PROC_INSERT_ADRESA(
        p_cp              IN NUMBER,
        p_id_mesto        IN NUMBER,
        p_id_ulice        IN NUMBER,
        p_id_psc          IN NUMBER,
        
        o_id_adresa       OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_ADRESA(
        p_id_adresa       IN NUMBER,
        p_cp              IN NUMBER,
        p_id_mesto        IN NUMBER,
        p_id_ulice        IN NUMBER,
        p_id_psc          IN NUMBER,

        o_id_adresa       OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_ADRESA(
        p_id_adresa       IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );
END PCK_ADRESY;

/
--------------------------------------------------------
--  DDL for Package PCK_DOTAZY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_DOTAZY" AS
    PROCEDURE PROC_INSERT_DOTAZ(
        p_text IN CLOB,
        p_verejny IN NUMBER DEFAULT 0,
        p_odpoved IN CLOB DEFAULT NULL,
        p_id_odpovidajici_uzivatel IN NUMBER DEFAULT NULL,
        o_id_dotaz OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_DOTAZ(
        p_id_dotaz IN NUMBER,
        p_text IN CLOB,
        p_verejny IN NUMBER,
        p_odpoved IN CLOB,
        p_id_odpovidajici_uzivatel IN NUMBER,
        o_id_dotaz OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_DOTAZ(
        p_id_dotaz IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_DOTAZY;

/
--------------------------------------------------------
--  DDL for Package PCK_GLOBAL_EXCEPTIONS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_GLOBAL_EXCEPTIONS" 
AS
    
    E_INVALID_PSC_FORMAT EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_INVALID_PSC_FORMAT, -20001);


    E_FK_MESTO_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_MESTO_NEEXISTUJE, -20401);

    E_FK_ULICE_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_ULICE_NEEXISTUJE, -20402);

    E_FK_PSC_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_PSC_NEEXISTUJE, -20403);

    E_FK_ADRESA_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_ADRESA_NEEXISTUJE, -20422); 


    E_FK_KATEGORIE_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_KATEGORIE_NEEXISTUJE, -20404); 

    E_CANNOT_DELETE_PARENT EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_CANNOT_DELETE_PARENT, -20405); 


    E_FK_OBRAZEK_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_OBRAZEK_NEEXISTUJE, -20407); 


    E_INVALID_UROVEN EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_INVALID_UROVEN, -20410); 

    E_FK_OPRAVNENI_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_OPRAVNENI_NEEXISTUJE, -20420); 


    E_FK_UZIVATEL_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_UZIVATEL_NEEXISTUJE, -20411); 

    E_FK_STAV_OBJEDNAVKY_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_STAV_OBJEDNAVKY_NEEXISTUJE, -20412); 

    E_FK_ZPUSOB_PLATBY_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_ZPUSOB_PLATBY_NEEXISTUJE, -20413); 


    E_NEPLATNY_FORMAT_EMAILU EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_NEPLATNY_FORMAT_EMAILU, -20423);


    E_FK_KVETINA_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_KVETINA_NEEXISTUJE, -20430);

    E_FK_KOSIK_NEEXISTUJE EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_FK_KOSIK_NEEXISTUJE, -20431);

    E_NEPLATNY_POCET EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_NEPLATNY_POCET, -20432);


    E_NEKONZISTENTNI_ODPOVED EXCEPTION;
    PRAGMA EXCEPTION_INIT(E_NEKONZISTENTNI_ODPOVED, -20440);

END PCK_GLOBAL_EXCEPTIONS;

/
--------------------------------------------------------
--  DDL for Package PCK_HESLA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_HESLA" 
AS
    FUNCTION FUNC_GENERUJ_SUL
    RETURN VARCHAR2;

    FUNCTION FUNC_GENERUJ_HESLO
    RETURN VARCHAR2;

    PROCEDURE PROC_ZMEN_HESLO(
        p_id_uzivatele IN uzivatele.id_uzivatel%TYPE,
        p_nove_heslo IN VARCHAR2,
        
        o_status OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
    
    PROCEDURE PROC_REGISTRUJ_UZIVATELE(
        p_email IN VARCHAR2,
        p_heslo IN VARCHAR2,
        p_ulice IN VARCHAR2,
        p_cp    IN NUMBER,
        p_mesto IN VARCHAR2,
        p_psc   IN VARCHAR2,
        
        o_id_uzivatel    OUT NUMBER,
        o_status         OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
    
    FUNCTION FUNC_OVER_HESLO(
        p_email IN VARCHAR2,
        p_heslo IN VARCHAR2,
        
        o_id_uzivatel OUT NUMBER
    )
    RETURN NUMBER;
    
    
END PCK_HESLA;

/
--------------------------------------------------------
--  DDL for Package PCK_KATEGORIE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_KATEGORIE" 
AS
    FUNCTION FUNC_IS_CYCLIC_HIERARCHY(
        p_id_kategorie IN NUMBER,
        p_id_nadrazene IN NUMBER 
    )
    RETURN BOOLEAN;

    PROCEDURE PROC_INSERT_KATEGORIE(
        p_nazev           IN VARCHAR2,
        p_id_nadrazene    IN NUMBER,

        o_id_kategorie    OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_KATEGORIE(
        p_id_kategorie    IN NUMBER,
        p_nazev           IN VARCHAR2,
        p_id_nadrazene    IN NUMBER,

        o_id_kategorie    OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_KATEGORIE(
        p_id_kategorie    IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );
END PCK_KATEGORIE;

/
--------------------------------------------------------
--  DDL for Package PCK_KOSIKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_KOSIKY" AS
    PROCEDURE PROC_INSERT_KOSIK(
        p_cena IN NUMBER,
        p_sleva IN NUMBER,
        p_id_uzivatel IN NUMBER,
        p_id_stav IN NUMBER,
        p_id_platba IN NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_KOSIK(
        p_id_kosik IN NUMBER,
        p_cena IN NUMBER,
        p_sleva IN NUMBER,
        p_id_uzivatel IN NUMBER,
        p_id_stav IN NUMBER,
        p_id_platba IN NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_KOSIK(
        p_id_kosik IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_KOSIKY;

/
--------------------------------------------------------
--  DDL for Package PCK_KVETINY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_KVETINY" AS
    FUNCTION FUNC_IS_PRICE_VALID(p_cena IN NUMBER) RETURN BOOLEAN;

    PROCEDURE PROC_INSERT_KVETINA(
        p_nazev IN VARCHAR2,
        p_cena IN NUMBER,
        p_id_kategorie IN NUMBER,
        p_id_obrazek IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_KVETINA(
        p_id_kvetina IN NUMBER,
        p_nazev IN VARCHAR2,
        p_cena IN NUMBER,
        p_id_kategorie IN NUMBER,
        p_id_obrazek IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_KVETINA(
        p_id_kvetina IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_KVETINY;

/
--------------------------------------------------------
--  DDL for Package PCK_KVETINYKOSIKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_KVETINYKOSIKY" AS
    PROCEDURE PROC_INSERT_KVETINYKOSIKY(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER,
        p_pocet IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_KVETINYKOSIKY(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER,
        p_pocet IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_KVETINYKOSIKY(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_KVETINYKOSIKY;

/
--------------------------------------------------------
--  DDL for Package PCK_MESTA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_MESTA" 
AS  
    PROCEDURE PROC_INSERT_MESTO(
        p_nazev           IN VARCHAR2,
        
        o_id_mesto        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_MESTO(
        p_id_mesto        IN NUMBER,
        p_nazev           IN VARCHAR2,

        o_id_mesto        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_MESTO(
        p_id_mesto        IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );
END PCK_MESTA;

/
--------------------------------------------------------
--  DDL for Package PCK_OBRAZKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_OBRAZKY" AS
    
    PROCEDURE PROC_INSERT_OBRAZEK(
        p_nazev_souboru  IN VARCHAR2,
        p_data           IN BLOB,
        
        o_id_obrazek     OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_OBRAZEK(
        p_id_obrazek     IN NUMBER,
        p_nazev_souboru  IN VARCHAR2,
        p_data           IN BLOB,

        o_id_obrazek     OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_OBRAZEK(
        p_id_obrazek     IN NUMBER,

        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_OBRAZKY;

/
--------------------------------------------------------
--  DDL for Package PCK_OPRAVNENI
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_OPRAVNENI" AS
    PROCEDURE PROC_INSERT_OPRAVNENI(
        p_nazev IN VARCHAR2,
        p_uroven IN NUMBER,
        o_id_opravneni OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_OPRAVNENI(
        p_id_opravneni IN NUMBER,
        p_nazev IN VARCHAR2,
        p_uroven IN NUMBER,
        o_id_opravneni OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_OPRAVNENI(
        p_id_opravneni IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_OPRAVNENI;

/
--------------------------------------------------------
--  DDL for Package PCK_PLATBY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_PLATBY" AS
    PROCEDURE PROC_INSERT_PLATBA(
        p_nazev IN VARCHAR2,
        o_id_zpusob_platby OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_PLATBA(
        p_id_zpusob_platby IN NUMBER,
        p_nazev IN VARCHAR2,
        o_id_zpusob_platby OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_PLATBA(
        p_id_zpusob_platby IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_PLATBY;

/
--------------------------------------------------------
--  DDL for Package PCK_PSC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_PSC" 
AS
    PROCEDURE PROC_INSERT_PSC(
        p_psc             IN VARCHAR2,
        
        o_id_psc          OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_PSC(
        p_id_psc          IN NUMBER,
        p_psc             IN VARCHAR2,

        o_id_psc          OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_PSC(
        p_id_psc          IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );
END PCK_PSC;

/
--------------------------------------------------------
--  DDL for Package PCK_STAVY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_STAVY" AS
    
    PROCEDURE PROC_INSERT_STAV(
        p_nazev          IN VARCHAR2,
        
        o_id             OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_STAV(
        p_id             IN NUMBER,
        p_nazev          IN VARCHAR2,

        o_id             OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_STAV(
        p_id             IN NUMBER,

        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_STAVY;

/
--------------------------------------------------------
--  DDL for Package PCK_STAVYOBJEDNAVEK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_STAVYOBJEDNAVEK" AS
    PROCEDURE PROC_INSERT_STAV(
        p_nazev IN VARCHAR2,
        o_id_stav_objednavky OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_STAV(
        p_id_stav_objednavky IN NUMBER,
        p_nazev IN VARCHAR2,
        o_id_stav_objednavky OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_STAV(
        p_id_stav_objednavky IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_STAVYOBJEDNAVEK;

/
--------------------------------------------------------
--  DDL for Package PCK_ULICE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_ULICE" 
AS
    PROCEDURE PROC_INSERT_ULICE(
        p_nazev           IN VARCHAR2,
        
        o_id_ulice        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_ULICE(
        p_id_ulice        IN NUMBER,
        p_nazev           IN VARCHAR2,

        o_id_ulice        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_ULICE(
        p_id_ulice        IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    );
END PCK_ULICE;

/
--------------------------------------------------------
--  DDL for Package PCK_UZIVATELE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "ST67009"."PCK_UZIVATELE" AS
    FUNCTION FUNC_IS_EMAIL_VALID(p_email IN VARCHAR2) RETURN BOOLEAN;

    PROCEDURE PROC_INSERT_UZIVATEL(
        p_email IN VARCHAR2,
        p_pw_hash IN CHAR,
        p_salt IN CHAR,
        p_id_opravneni IN NUMBER,
        p_id_obrazek IN NUMBER,
        p_id_adresa IN NUMBER,
        o_id_uzivatel OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_UPDATE_UZIVATEL(
        p_id_uzivatel IN NUMBER,
        p_email IN VARCHAR2,
        p_pw_hash IN CHAR,
        p_salt IN CHAR,
        p_id_opravneni IN NUMBER,
        p_id_obrazek IN NUMBER,
        p_id_adresa IN NUMBER,
        o_id_uzivatel OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );

    PROCEDURE PROC_DELETE_UZIVATEL(
        p_id_uzivatel IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    );
END PCK_UZIVATELE;

/
--------------------------------------------------------
--  DDL for Package Body DATUMY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."DATUMY" 
AS
    FUNCTION datumy_rozdil(
        datum_od DATE, 
        datum_do DATE, 
        typ CHAR
    )
    RETURN NUMBER AS
    BEGIN
        IF datum_od IS NULL
            OR datum_do IS NULL
        THEN
            raise_application_error(-20003, 'Spatny vstupni parametr');
        END IF;

        CASE 
            WHEN upper(typ) = 'D' THEN
                RETURN ROUND(DATEDIFF(day, datum_do, datum_od), 2);
            WHEN upper(typ) = 'H' THEN
                RETURN ROUND(DATEDIFF(hour, datum_do, datum_od), 2);
            WHEN upper(typ) = 'M' THEN
                RETURN ROUND(DATEDIFF(minute, datum_do, datum_od), 2);
            WHEN upper(typ) = 'S' THEN
                RETURN ROUND(DATEDIFF(second, datum_do, datum_od), 2);
            ELSE
                raise_application_error(-20003, 'Spatny vstupni parametr');
        END CASE;
    END;

    FUNCTION pracovni_den(
        datum DATE
    )
    RETURN NUMBER;
    IS
    BEGIN
        IF WEEKDAY(datum) > 1 AND WEEKDAY(datum) < 7 THEN
            RETURN 1;
        ELSE
            RETURN 0;
        END IF;
    END;

    FUNCTION den_v_mesici(
        datum DATE,
        prvni NUMBER
    ) 
    RETURN DATE;
    IS
    BEGIN
        IF prvni = 1 THEN
            RETURN TRUNC(datum, 'MM');
        ELSE
            RETURN LAST_DAY(datum);
    END;
END DATUMY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_ADMINISTRATIVA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_ADMINISTRATIVA" 
AS
    PROCEDURE PROC_SMAZ_STARE_DOTAZY(
        p_starsi_nez            IN DATE,
        
        o_pocet_smazanych       OUT NUMBER
    )
    AS
        CURSOR c_stare_dotazy IS
            SELECT *
            FROM DOTAZY
            WHERE CAST(datum_podani AS DATE) < p_starsi_nez AND odpoved IS NULL;
        r_dotazy                DOTAZY%ROWTYPE;
        v_pocet_smazanych       NUMBER DEFAULT 0;
    BEGIN
        OPEN c_stare_dotazy;
        LOOP
            FETCH c_stare_dotazy INTO r_dotazy;
            EXIT WHEN c_stare_dotazy%NOTFOUND;

            DELETE FROM DOTAZY
            WHERE id_dotaz = r_dotazy.id_dotaz;

            v_pocet_smazanych := v_pocet_smazanych + 1;
        END LOOP;
        CLOSE c_stare_dotazy;

        COMMIT;

        o_pocet_smazanych := v_pocet_smazanych;
    END PROC_SMAZ_STARE_DOTAZY;

    PROCEDURE PROC_PODEJ_OBJEDNAVKU(
        p_id_uzivatel           IN UZIVATELE.id_uzivatel%TYPE,
        p_id_zpusob_platby      IN ZPUSOBYPLATEB.id_zpusob_platby%TYPE,
        p_objednane_kvetiny     IN T_KVETINA_KOSIK_LIST,

        o_novy_kosik_id         OUT KOSIKY.id_kosik%TYPE
    )
    AS
        c_narok_na_slevu        CONSTANT NUMBER := 5;

        v_novy_kosik_id         KOSIKY.id_kosik%TYPE;
        v_kvetina_cena          KVETINY.cena%TYPE;
        v_celkova_cena          KOSIKY.cena%TYPE DEFAULT 0;
        v_pocet_predchozich_obj NUMBER DEFAULT 0;
        v_sleva                 NUMBER DEFAULT 0;
    BEGIN
        IF FUNC_NAROK_NA_SLEVU(p_id_uzivatel) = 1 THEN
            v_sleva := 10;
        ELSE
            v_sleva := 0;
        END IF;

        INSERT INTO KOSIKY (
            id_kosik,
            datum_vytvoreni, 
            cena, 
            sleva, 
            id_uzivatel, 
            id_stav_objednavky, 
            id_zpusob_platby
        )
        VALUES (
            s_Kosiky_id_kosik.NEXTVAL,
            SYSTIMESTAMP AT LOCAL,
            0,
            v_sleva,
            p_id_uzivatel,
            (SELECT id_stav_objednavky FROM STAVYOBJEDNAVEK WHERE nazev = 'Čeká na zaplacení'),
            p_id_zpusob_platby
        )
        RETURNING id_kosik INTO v_novy_kosik_id;

        FOR i IN 1..p_objednane_kvetiny.COUNT 
        LOOP

            BEGIN
                SELECT cena INTO v_kvetina_cena
                FROM KVETINY
                WHERE id_kvetina = p_objednane_kvetiny(i).id_kvetina;
            EXCEPTION
                WHEN NO_DATA_FOUND THEN
                    RAISE_APPLICATION_ERROR(-20002, 
                        'Kvetina s ID ' || p_objednane_kvetiny(i).id_kvetina || ' nebyla nalezena.'
                    );
            END;

            INSERT INTO KVETINYKOSIKY (
                id_kvetina,
                id_kosik,
                pocet
            )
            VALUES (
                p_objednane_kvetiny(i).id_kvetina, 
                v_novy_kosik_id,
                p_objednane_kvetiny(i).pocet
            );

            v_celkova_cena := v_celkova_cena + (v_kvetina_cena * p_objednane_kvetiny(i).pocet);
        END LOOP;

        UPDATE KOSIKY
        SET cena = v_celkova_cena - (v_celkova_cena / 100) * v_sleva
        WHERE id_kosik = v_novy_kosik_id;

        COMMIT;

        o_novy_kosik_id := v_novy_kosik_id;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
    END PROC_PODEJ_OBJEDNAVKU;

    FUNCTION FUNC_NAROK_NA_SLEVU(
        p_id_uzivatel           IN UZIVATELE.id_uzivatel%TYPE
    )
    RETURN NUMBER
    AS
        c_pocet_predchozich_obj CONSTANT NUMBER := 4;

        v_pocet_obj             NUMBER := 0;
    BEGIN
        FOR r_predchozi_obj IN (
            SELECT 
                l.*,
                (
                    SELECT 
                        CAST(
                            TO_TIMESTAMP_TZ(
                                JSON_VALUE(l2.novy_zaznam, '$.datum_vytvoreni'),
                                'YYYY-MM-DD HH24:MI:SS TZH:TZM'
                            ) AS TIMESTAMP WITH LOCAL TIME ZONE
                        ) 
                    FROM
                        LOGS l2
                    WHERE l2.id_log = l.id_log
                ) AS datum_vytvoreni
            FROM 
                LOGS l
            WHERE 
                UPPER(l.nazev_tabulky) = UPPER('Kosiky') 
                AND l.id_log_akce = (
                    SELECT id_log_akce 
                    FROM LOGAKCE 
                    WHERE nazev = 'Insert' 
                )
                AND JSON_VALUE(l.novy_zaznam, '$.id_uzivatel') = p_id_uzivatel
            ORDER BY 
                datum_vytvoreni DESC
            )
        LOOP
            EXIT WHEN JSON_VALUE(r_predchozi_obj.novy_zaznam, '$.sleva') = 10;

            v_pocet_obj := v_pocet_obj + 1;
        END LOOP;

        IF v_pocet_obj >= c_pocet_predchozich_obj THEN
            RETURN 1;
        ELSE
            RETURN 0;
        END IF;

    END FUNC_NAROK_NA_SLEVU;

    PROCEDURE PROC_PRIDEJ_DOTAZ(
        p_text IN CLOB,

        o_id_dotaz OUT NUMBER,
        o_status OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        PCK_DOTAZY.PROC_INSERT_DOTAZ(p_text, 0, null, null, o_id_dotaz, o_status, o_status_message);
    END;

    PROCEDURE PROC_ODPOVED_NA_DOTAZ(
        p_id_dotaz IN NUMBER,
        p_id_odpovidajici_uzivatel IN NUMBER,
        p_odpoved IN CLOB,

        o_id_dotaz OUT NUMBER,
        o_status OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        r_dotaz DOTAZY%ROWTYPE;
    BEGIN
        SELECT * INTO r_dotaz FROM dotazy WHERE id_dotaz = p_id_dotaz;

        PCK_DOTAZY.PROC_UPDATE_DOTAZ(p_id_dotaz, r_dotaz.text, r_dotaz.verejny, p_odpoved, p_id_odpovidajici_uzivatel, o_id_dotaz, o_status, o_status_message);
    END;

END PCK_ADMINISTRATIVA;

/
--------------------------------------------------------
--  DDL for Package Body PCK_ADRESY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_ADRESY" 
AS
    

    v_existuje NUMBER;

    PROCEDURE CHECK_FOREIGN_KEYS(
        p_id_mesto IN NUMBER,
        p_id_ulice IN NUMBER,
        p_id_psc   IN NUMBER
    )
    AS
    BEGIN
        BEGIN
            SELECT 1 INTO v_existuje FROM mesta WHERE id_mesto = p_id_mesto;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_MESTO_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM ulice WHERE id_ulice = p_id_ulice;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_ULICE_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM psc WHERE id_psc = p_id_psc;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_PSC_NEEXISTUJE;
        END;
    END CHECK_FOREIGN_KEYS;

    PROCEDURE PROC_INSERT_ADRESA(
        p_cp              IN NUMBER,
        p_id_mesto        IN NUMBER,
        p_id_ulice        IN NUMBER,
        p_id_psc          IN NUMBER,

        o_id_adresa       OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_id_adresa adresy.id_adresa%TYPE;
    BEGIN
        CHECK_FOREIGN_KEYS(p_id_mesto, p_id_ulice, p_id_psc);

        SELECT id_adresa
        INTO v_id_adresa
        FROM adresy
        WHERE cp = p_cp 
          AND id_mesto = p_id_mesto 
          AND id_ulice = p_id_ulice 
          AND id_psc = p_id_psc;

        o_id_adresa := v_id_adresa;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO adresy(cp, id_mesto, id_ulice, id_psc)
            VALUES(p_cp, p_id_mesto, p_id_ulice, p_id_psc)
            RETURNING id_adresa INTO o_id_adresa;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_MESTO_NEEXISTUJE THEN
            o_id_adresa := NULL; 
            o_status_code := -401;
            o_status_message := 'Selhání cizího klíče: Zadané město neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_ULICE_NEEXISTUJE THEN
            o_id_adresa := NULL; 
            o_status_code := -402;
            o_status_message := 'Selhání cizího klíče: Zadaná ulice neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_PSC_NEEXISTUJE THEN
            o_id_adresa := NULL; 
            o_status_code := -403;
            o_status_message := 'Selhání cizího klíče: Zadané PSČ neexistuje.';

        WHEN OTHERS THEN
            o_id_adresa := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_ADRESA;

    PROCEDURE PROC_UPDATE_ADRESA(
        p_id_adresa       IN NUMBER,
        p_cp              IN NUMBER,
        p_id_mesto        IN NUMBER,
        p_id_ulice        IN NUMBER,
        p_id_psc          IN NUMBER,

        o_id_adresa       OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
    BEGIN
        CHECK_FOREIGN_KEYS(p_id_mesto, p_id_ulice, p_id_psc);

        UPDATE adresy
        SET
            cp = p_cp,
            id_mesto = p_id_mesto,
            id_ulice = p_id_ulice,
            id_psc = p_id_psc
        WHERE
            id_adresa = p_id_adresa;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_ADRESA(p_cp, p_id_mesto, p_id_ulice, p_id_psc, o_id_adresa, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_adresa := p_id_adresa;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_MESTO_NEEXISTUJE THEN
            o_id_adresa := p_id_adresa; 
            o_status_code := -401;
            o_status_message := 'Selhání cizího klíče: Zadané město neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_ULICE_NEEXISTUJE THEN
            o_id_adresa := p_id_adresa; 
            o_status_code := -402;
            o_status_message := 'Selhání cizího klíče: Zadaná ulice neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_PSC_NEEXISTUJE THEN
            o_id_adresa := p_id_adresa; 
            o_status_code := -403;
            o_status_message := 'Selhání cizího klíče: Zadané PSČ neexistuje.';

        WHEN OTHERS THEN
            o_id_adresa := p_id_adresa;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_ADRESA;

    PROCEDURE PROC_DELETE_ADRESA(
        p_id_adresa       IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM adresy
        WHERE id_adresa = p_id_adresa;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN    
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_ADRESA;

END PCK_ADRESY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_DOTAZY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_DOTAZY" AS
    
    v_existuje NUMBER;

    PROCEDURE CHECK_FOREIGN_KEYS(
        p_id_uzivatel IN NUMBER
    )
    AS
    BEGIN
        SELECT 1 INTO v_existuje FROM UZIVATELE WHERE id_uzivatel = p_id_uzivatel;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_UZIVATEL_NEEXISTUJE;
    END CHECK_FOREIGN_KEYS;

    PROCEDURE CHECK_LOGIC(
        p_odpoved IN CLOB,
        p_id_odpovidajici_uzivatel IN NUMBER
    )
    AS
    BEGIN
        IF (p_odpoved IS NULL AND p_id_odpovidajici_uzivatel IS NOT NULL) OR 
           (p_odpoved IS NOT NULL AND p_id_odpovidajici_uzivatel IS NULL) 
        THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_NEKONZISTENTNI_ODPOVED;
        END IF;
    END CHECK_LOGIC;

    PROCEDURE PROC_INSERT_DOTAZ(
        p_text IN CLOB,
        p_verejny IN NUMBER DEFAULT 0,
        p_odpoved IN CLOB DEFAULT NULL,
        p_id_odpovidajici_uzivatel IN NUMBER DEFAULT NULL,
        o_id_dotaz OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        CHECK_LOGIC(p_odpoved, p_id_odpovidajici_uzivatel);

        IF p_id_odpovidajici_uzivatel IS NOT NULL THEN
            CHECK_FOREIGN_KEYS(p_id_odpovidajici_uzivatel);
        END IF;

        INSERT INTO DOTAZY(datum_podani, verejny, text, odpoved, id_odpovidajici_uzivatel)
        VALUES (SYSTIMESTAMP, p_verejny, p_text, p_odpoved, p_id_odpovidajici_uzivatel)
        RETURNING id_dotaz INTO o_id_dotaz;

        o_status_code := 1;
        o_status_message := 'Úspěch: Operace proběhla úspěšně.';

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_NEKONZISTENTNI_ODPOVED THEN
            o_id_dotaz := NULL;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: Odpověď a ID odpovídajícího uživatele musí být buď oba vyplněné, nebo oba NULL.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_UZIVATEL_NEEXISTUJE THEN
            o_id_dotaz := NULL; o_status_code := -411;
            o_status_message := 'Selhání cizího klíče: Zadaný ID odpovídajícího uživatele neexistuje.';

        WHEN OTHERS THEN
            o_id_dotaz := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_DOTAZ;

    PROCEDURE PROC_UPDATE_DOTAZ(
        p_id_dotaz IN NUMBER,
        p_text IN CLOB,
        p_verejny IN NUMBER,
        p_odpoved IN CLOB,
        p_id_odpovidajici_uzivatel IN NUMBER,
        o_id_dotaz OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        CHECK_LOGIC(p_odpoved, p_id_odpovidajici_uzivatel);

        IF p_id_odpovidajici_uzivatel IS NOT NULL THEN
            CHECK_FOREIGN_KEYS(p_id_odpovidajici_uzivatel);
        END IF;

        UPDATE DOTAZY
        SET text = p_text,
            verejny = p_verejny,
            odpoved = p_odpoved,
            id_odpovidajici_uzivatel = p_id_odpovidajici_uzivatel
        WHERE id_dotaz = p_id_dotaz;

        IF SQL%ROWCOUNT = 0 THEN
            o_id_dotaz := p_id_dotaz;
            o_status_code := 0; 
            o_status_message := 'Selhání aktualizace: Záznam nebyl nalezen.';
        ELSE
            o_id_dotaz := p_id_dotaz;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_NEKONZISTENTNI_ODPOVED THEN
            o_id_dotaz := p_id_dotaz;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: Odpověď a ID odpovídajícího uživatele musí být buď oba vyplněné, nebo oba prázdné.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_UZIVATEL_NEEXISTUJE THEN
            o_id_dotaz := p_id_dotaz;
            o_status_code := -411; 
            o_status_message := 'Selhání cizího klíče: Zadaný ID odpovídajícího uživatele neexistuje.';

        WHEN OTHERS THEN
            o_id_dotaz := p_id_dotaz;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_DOTAZ;


    PROCEDURE PROC_DELETE_DOTAZ(
        p_id_dotaz IN NUMBER,

        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM DOTAZY
        WHERE id_dotaz = p_id_dotaz;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_DOTAZ;
END PCK_DOTAZY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_HESLA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_HESLA" 
AS
    FUNCTION FUNC_GENERUJ_SUL
    RETURN VARCHAR2
    IS
        C_SUL_LENGTH    NUMBER DEFAULT 32;

        O_SUL           VARCHAR2(32);
    BEGIN
        O_SUL := DBMS_RANDOM.STRING('X', C_SUL_LENGTH);
        RETURN O_SUL;
    END FUNC_GENERUJ_SUL;

    FUNCTION FUNC_GENERUJ_HESLO
    RETURN VARCHAR2
    IS
        c_znaky CONSTANT VARCHAR2(22) := '!@#$%^&*()_+{}:<>?/;][';

        v_vyber NUMBER;
        v_velke_pismeno BOOLEAN;
        v_alespon_jedno_velke BOOLEAN DEFAULT FALSE;
        v_alespon_jeden_znak BOOLEAN DEFAULT FALSE;
        v_pocet_cisel NUMBER DEFAULT 0;

        o_heslo VARCHAR2(12) := '';
    BEGIN
        FOR i IN 1..12
        LOOP
            IF i BETWEEN 8 AND 10 AND v_pocet_cisel < 3 THEN
                o_heslo := o_heslo || TRUNC(DBMS_RANDOM.VALUE(0, 10));
                v_pocet_cisel := v_pocet_cisel + 1;
                CONTINUE;
            END IF;

            IF i = 11 AND NOT v_alespon_jedno_velke THEN
                o_heslo := o_heslo || DBMS_RANDOM.STRING('U', 1);
                CONTINUE;
            END IF;

            IF i = 12 AND NOT v_alespon_jeden_znak THEN
                o_heslo := o_heslo || SUBSTR(c_znaky, TRUNC(DBMS_RANDOM.VALUE(1, LENGTH(c_znaky) + 1)), 1);
                CONTINUE;
            END IF;

            v_vyber := TRUNC(DBMS_RANDOM.VALUE(1, 4));


            CASE
                WHEN v_vyber = 1 THEN
                    v_velke_pismeno := TRUNC(DBMS_RANDOM.VALUE(0, 2)) MOD 2 = 0;
                    IF v_velke_pismeno THEN
                        o_heslo := o_heslo || DBMS_RANDOM.STRING('U', 1);
                        v_alespon_jedno_velke := TRUE;
                    ELSE
                        o_heslo := o_heslo || DBMS_RANDOM.STRING('L', 1);
                    END IF;
                WHEN v_vyber = 2 THEN
                    o_heslo := o_heslo || TRUNC(DBMS_RANDOM.VALUE(0, 10));
                    v_pocet_cisel := v_pocet_cisel + 1;
                WHEN v_vyber = 3 THEN
                    o_heslo := o_heslo || SUBSTR(c_znaky, TRUNC(DBMS_RANDOM.VALUE(1, LENGTH(c_znaky) + 1)), 1);
                    v_alespon_jeden_znak := TRUE;
            END CASE;
        END LOOP;

        RETURN o_heslo;
    END FUNC_GENERUJ_HESLO;

    PROCEDURE PROC_ZMEN_HESLO (
        p_id_uzivatele IN UZIVATELE.ID_UZIVATEL%TYPE,
        p_nove_heslo  IN VARCHAR2,
        
        o_status OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_nova_sul UZIVATELE.SALT%TYPE;
        v_novy_hash UZIVATELE.PW_HASH%TYPE;

        E_UZIVATEL_NENALEZEN EXCEPTION;
        PRAGMA EXCEPTION_INIT(E_UZIVATEL_NENALEZEN, -20001);
    BEGIN
        v_nova_sul := FUNC_GENERUJ_SUL();

        SELECT RAWTOHEX(STANDARD_HASH(p_nove_heslo || v_nova_sul, 'SHA256')) INTO v_novy_hash
        FROM dual;

        UPDATE UZIVATELE
        SET
            PW_HASH = v_novy_hash,
            SALT = v_nova_sul
        WHERE
            ID_UZIVATEL = p_id_uzivatele;

        IF SQL%ROWCOUNT = 0 THEN
            RAISE_APPLICATION_ERROR(-20001, 'Uživatel nebyl nalezen.');
        END IF;

        o_status := 1;
        o_status_message := 'Změna hesla proběhla úspěšně';

        COMMIT;
    EXCEPTION
        WHEN E_UZIVATEL_NENALEZEN THEN
            o_status := -400;
            o_status_message := 'Uživatel nebyl nalezen';            

        WHEN OTHERS THEN
            o_status := -999;
            o_status_message := 'Chyba databáze: ' || SQLERRM;
    END PROC_ZMEN_HESLO;

    PROCEDURE PROC_REGISTRUJ_UZIVATELE(
        p_email IN VARCHAR2,
        p_heslo IN VARCHAR2,
        p_ulice IN VARCHAR2,
        p_cp    IN NUMBER,
        p_mesto IN VARCHAR2,
        p_psc   IN VARCHAR2,

        o_id_uzivatel    OUT NUMBER,
        o_status         OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_letters_ok BOOLEAN;
        v_length_ok BOOLEAN;
        v_symbol_ok BOOLEAN;
        v_capital_ok BOOLEAN;

        v_id_mesto NUMBER;
        v_id_ulice NUMBER;
        v_id_psc   NUMBER;
        v_id_adresa NUMBER;
        v_sul      VARCHAR2(32);
        v_pw_hash  VARCHAR2(64);
    BEGIN
        v_length_ok := (LENGTH(p_heslo) = 12);
        v_letters_ok := (REGEXP_COUNT(p_heslo, '[a-zA-Z]') >= 3);
        v_symbol_ok := (REGEXP_COUNT(p_heslo, '[^a-zA-Z0-9]') >= 1);
        v_capital_ok := (REGEXP_COUNT(p_heslo, '[A-Z]') >= 1);

        IF NOT (v_length_ok AND v_letters_ok AND v_symbol_ok AND v_capital_ok) THEN
            o_id_uzivatel := -1;
            o_status := -999;
            o_status_message := 'Chyba registrace: Neplatné heslo';
            RETURN;
        END IF;

        PCK_MESTA.PROC_INSERT_MESTO(p_mesto, v_id_mesto, o_status, o_status_message);
        PCK_ULICE.PROC_INSERT_ULICE(p_ulice, v_id_ulice, o_status, o_status_message);
        PCK_PSC.PROC_INSERT_PSC(p_psc, v_id_psc, o_status, o_status_message);
        PCK_ADRESY.PROC_INSERT_ADRESA(p_cp, v_id_mesto, v_id_ulice, v_id_psc, v_id_adresa, o_status, o_status_message); 

        v_sul := FUNC_GENERUJ_SUL();

        SELECT RAWTOHEX(STANDARD_HASH(p_heslo || v_sul, 'SHA256')) INTO v_pw_hash
        FROM dual;

        PCK_UZIVATELE.PROC_INSERT_UZIVATEL(p_email, v_pw_hash, v_sul, 1, 6, v_id_adresa, o_id_uzivatel, o_status, o_status_message);
    END PROC_REGISTRUJ_UZIVATELE;

    FUNCTION FUNC_OVER_HESLO(
        p_email IN VARCHAR2,
        p_heslo IN VARCHAR2,
        
        o_id_uzivatel OUT NUMBER
    )
    RETURN NUMBER
    IS
        v_incoming_pw_hash VARCHAR2(64);

        v_existujici_pw_hash VARCHAR2(64) DEFAULT NULL;
        v_sul     VARCHAR2(32) DEFAULT NULL;
    BEGIN
        SELECT id_uzivatel, pw_hash, salt
        INTO o_id_uzivatel, v_existujici_pw_hash, v_sul
        FROM uzivatele
        WHERE email = p_email;

        IF v_sul = NULL AND v_existujici_pw_hash = NULL THEN
            RETURN -1;
        END IF;

        SELECT RAWTOHEX(STANDARD_HASH(p_heslo || v_sul, 'SHA256'))
        INTO v_incoming_pw_hash
        FROM dual;

        IF v_incoming_pw_hash = v_existujici_pw_hash THEN
            RETURN 1;
        ELSE
            RETURN 0;
        END IF;
    END FUNC_OVER_HESLO;


END PCK_HESLA;

/
--------------------------------------------------------
--  DDL for Package Body PCK_KATEGORIE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_KATEGORIE" 
AS
    
    
    FUNCTION FUNC_IS_CYCLIC_HIERARCHY(
        p_id_kategorie IN NUMBER,
        p_id_nadrazene IN NUMBER
    )
    RETURN BOOLEAN
    AS
        v_is_cyclic NUMBER := 0;
    BEGIN
        IF p_id_nadrazene IS NULL THEN
            RETURN FALSE;
        END IF;

        SELECT 1
        INTO v_is_cyclic
        FROM DUAL
        WHERE EXISTS (
            SELECT 1
            FROM KATEGORIE
            START WITH id_kategorie = p_id_kategorie
            CONNECT BY PRIOR id_kategorie = id_nadrazene_kategorie
               AND id_kategorie = p_id_nadrazene
        );

        RETURN v_is_cyclic = 1;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RETURN FALSE;
        WHEN OTHERS THEN
            RETURN TRUE;
    END FUNC_IS_CYCLIC_HIERARCHY;


    PROCEDURE PROC_INSERT_KATEGORIE(
        p_nazev           IN VARCHAR2,
        p_id_nadrazene    IN NUMBER,

        o_id_kategorie    OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_id_kategorie KATEGORIE.ID_KATEGORIE%TYPE DEFAULT NULL;
        v_nazev_clean  KATEGORIE.NAZEV%TYPE := TRIM(p_nazev);
        v_existuje     NUMBER;
    BEGIN
        IF p_id_nadrazene IS NOT NULL THEN
            BEGIN
                SELECT 1 INTO v_existuje FROM KATEGORIE WHERE id_kategorie = p_id_nadrazene;
            EXCEPTION
                WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE;
            END;
        END IF;

        SELECT id_kategorie
        INTO v_id_kategorie
        FROM KATEGORIE
        WHERE UPPER(nazev) = UPPER(v_nazev_clean)
          AND NVL(id_nadrazene_kategorie,-1) = NVL(p_id_nadrazene,-1);

        o_id_kategorie := v_id_kategorie;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO KATEGORIE(nazev, id_nadrazene_kategorie)
            VALUES (v_nazev_clean, p_id_nadrazene)
            RETURNING id_kategorie INTO o_id_kategorie;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE THEN
            o_id_kategorie := NULL; o_status_code := -404;
            o_status_message := 'Selhání cizího klíče: Zadaná nadřazená kategorie neexistuje.';

        WHEN OTHERS THEN
            o_id_kategorie := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_KATEGORIE;


    PROCEDURE PROC_UPDATE_KATEGORIE(
        p_id_kategorie    IN NUMBER,
        p_nazev           IN VARCHAR2,
        p_id_nadrazene    IN NUMBER,

        o_id_kategorie    OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_nazev_clean  KATEGORIE.NAZEV%TYPE := TRIM(p_nazev);
        v_existuje     NUMBER;
    BEGIN
        IF FUNC_IS_CYCLIC_HIERARCHY(p_id_kategorie, p_id_nadrazene) THEN
            o_id_kategorie := p_id_kategorie;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: Vzniká cyklická hierarchie.';
            RETURN;
        END IF;

        IF p_id_nadrazene IS NOT NULL THEN
            BEGIN
                SELECT 1 INTO v_existuje FROM KATEGORIE WHERE id_kategorie = p_id_nadrazene;
            EXCEPTION
                WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE;
            END;
        END IF;

        UPDATE KATEGORIE
        SET nazev = v_nazev_clean,
            id_nadrazene_kategorie = p_id_nadrazene
        WHERE id_kategorie = p_id_kategorie;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_KATEGORIE(p_nazev, p_id_nadrazene, o_id_kategorie, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_kategorie := p_id_kategorie;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE THEN
            o_id_kategorie := p_id_kategorie; o_status_code := -404;
            o_status_message := 'Selhání cizího klíče: Zadaná nadřazená kategorie neexistuje.';

        WHEN OTHERS THEN
            o_id_kategorie := p_id_kategorie;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_KATEGORIE;


    PROCEDURE PROC_DELETE_KATEGORIE(
        p_id_kategorie    IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_count NUMBER;
    BEGIN
        SELECT COUNT(*)
        INTO v_count
        FROM KATEGORIE
        WHERE id_nadrazene_kategorie = p_id_kategorie;

        IF v_count > 0 THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_CANNOT_DELETE_PARENT;
        END IF;

        DELETE FROM KATEGORIE WHERE id_kategorie = p_id_kategorie;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN 
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_CANNOT_DELETE_PARENT THEN
            o_status_code := -30; 
            o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_KATEGORIE;
END PCK_KATEGORIE;

/
--------------------------------------------------------
--  DDL for Package Body PCK_KOSIKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_KOSIKY" AS
    
    v_existuje NUMBER;

    PROCEDURE CHECK_FOREIGN_KEYS(
        p_id_uzivatel IN NUMBER,
        p_id_stav IN NUMBER,
        p_id_platba IN NUMBER
    )
    AS
    BEGIN
        BEGIN
            SELECT 1 INTO v_existuje FROM UZIVATELE WHERE id_uzivatel = p_id_uzivatel;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_UZIVATEL_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM STAVYOBJEDNAVEK WHERE id_stav_objednavky = p_id_stav;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_STAV_OBJEDNAVKY_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM ZPUSOBYPLATEB WHERE id_zpusob_platby = p_id_platba;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_ZPUSOB_PLATBY_NEEXISTUJE;
        END;
    END CHECK_FOREIGN_KEYS;

    PROCEDURE PROC_INSERT_KOSIK(
        p_cena IN NUMBER,
        p_sleva IN NUMBER,
        p_id_uzivatel IN NUMBER,
        p_id_stav IN NUMBER,
        p_id_platba IN NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        CHECK_FOREIGN_KEYS(p_id_uzivatel, p_id_stav, p_id_platba);

        INSERT INTO KOSIKY(datum_vytvoreni, cena, sleva, id_uzivatel, id_stav_objednavky, id_zpusob_platby)
        VALUES (SYSTIMESTAMP, p_cena, p_sleva, p_id_uzivatel, p_id_stav, p_id_platba)
        RETURNING id_kosik INTO o_id_kosik;

        o_status_code := 1;
        o_status_message := 'Úspěch: Operace proběhla úspěšně.';

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_UZIVATEL_NEEXISTUJE THEN
            o_id_kosik := NULL; o_status_code := -411;
            o_status_message := 'Selhání cizího klíče: Zadaný uživatel neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_STAV_OBJEDNAVKY_NEEXISTUJE THEN
            o_id_kosik := NULL; o_status_code := -412;
            o_status_message := 'Selhání cizího klíče: Zadaný stav objednávky neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_ZPUSOB_PLATBY_NEEXISTUJE THEN
            o_id_kosik := NULL; o_status_code := -413;
            o_status_message := 'Selhání cizího klíče: Zadaný způsob platby neexistuje.';

        WHEN OTHERS THEN
            o_id_kosik := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_KOSIK;

    PROCEDURE PROC_UPDATE_KOSIK(
        p_id_kosik IN NUMBER,
        p_cena IN NUMBER,
        p_sleva IN NUMBER,
        p_id_uzivatel IN NUMBER,
        p_id_stav IN NUMBER,
        p_id_platba IN NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        CHECK_FOREIGN_KEYS(p_id_uzivatel, p_id_stav, p_id_platba);

        UPDATE KOSIKY
        SET cena = p_cena,
            sleva = p_sleva,
            id_uzivatel = p_id_uzivatel,
            id_stav_objednavky = p_id_stav,
            id_zpusob_platby = p_id_platba
        WHERE id_kosik = p_id_kosik;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_KOSIK(p_cena, p_sleva, p_id_uzivatel, p_id_stav, p_id_platba, o_id_kosik, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_kosik := p_id_kosik;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_UZIVATEL_NEEXISTUJE THEN
            o_id_kosik := p_id_kosik; o_status_code := -411;
            o_status_message := 'Selhání cizího klíče: Zadaný uživatel neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_STAV_OBJEDNAVKY_NEEXISTUJE THEN
            o_id_kosik := p_id_kosik; o_status_code := -412;
            o_status_message := 'Selhání cizího klíče: Zadaný stav objednávky neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_ZPUSOB_PLATBY_NEEXISTUJE THEN
            o_id_kosik := p_id_kosik; o_status_code := -413;
            o_status_message := 'Selhání cizího klíče: Zadaný způsob platby neexistuje.';

        WHEN OTHERS THEN
            o_id_kosik := p_id_kosik;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_KOSIK;

    PROCEDURE PROC_DELETE_KOSIK(
        p_id_kosik IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM KOSIKY
        WHERE id_kosik = p_id_kosik;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_KOSIK;
END PCK_KOSIKY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_KVETINY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_KVETINY" AS
    
    v_existuje NUMBER;

    FUNCTION FUNC_IS_PRICE_VALID(p_cena IN NUMBER) RETURN BOOLEAN
    AS
    BEGIN
        RETURN p_cena > 0;
    END FUNC_IS_PRICE_VALID;

    PROCEDURE CHECK_FOREIGN_KEYS(
        p_id_kategorie IN NUMBER,
        p_id_obrazek IN NUMBER
    )
    AS
    BEGIN
        BEGIN
            SELECT 1 INTO v_existuje FROM KATEGORIE WHERE id_kategorie = p_id_kategorie;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM OBRAZKY WHERE id_obrazek = p_id_obrazek;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_OBRAZEK_NEEXISTUJE;
        END;
    END CHECK_FOREIGN_KEYS;

    PROCEDURE PROC_INSERT_KVETINA(
        p_nazev IN VARCHAR2,
        p_cena IN NUMBER,
        p_id_kategorie IN NUMBER,
        p_id_obrazek IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_kvetina KVETINY.ID_KVETINA%TYPE;
        v_nazev_clean KVETINY.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        IF NOT FUNC_IS_PRICE_VALID(p_cena) THEN
            o_id_kvetina := NULL;
            o_status_code := -20;
            o_status_message := 'Selhání validace: Cena musí být kladné číslo.';
            RETURN;
        END IF;

        CHECK_FOREIGN_KEYS(p_id_kategorie, p_id_obrazek);

        SELECT id_kvetina
        INTO v_id_kvetina
        FROM KVETINY
        WHERE UPPER(nazev) = UPPER(v_nazev_clean); 

        o_id_kvetina := v_id_kvetina;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO KVETINY(nazev, cena, id_kategorie, id_obrazek)
            VALUES (v_nazev_clean, p_cena, p_id_kategorie, p_id_obrazek)
            RETURNING id_kvetina INTO o_id_kvetina;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE THEN
            o_id_kvetina := NULL; o_status_code := -404;
            o_status_message := 'Selhání cizího klíče: Zadaná kategorie neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_OBRAZEK_NEEXISTUJE THEN
            o_id_kvetina := NULL; o_status_code := -407;
            o_status_message := 'Selhání cizího klíče: Zadaný obrázek neexistuje.';

        WHEN OTHERS THEN
            o_id_kvetina := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_KVETINA;

    PROCEDURE PROC_UPDATE_KVETINA(
        p_id_kvetina IN NUMBER,
        p_nazev IN VARCHAR2,
        p_cena IN NUMBER,
        p_id_kategorie IN NUMBER,
        p_id_obrazek IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_nazev_clean KVETINY.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        IF NOT FUNC_IS_PRICE_VALID(p_cena) THEN
            o_id_kvetina := p_id_kvetina;
            o_status_code := -20;
            o_status_message := 'Selhání validace: Cena musí být kladné číslo.';
            RETURN;
        END IF;

        CHECK_FOREIGN_KEYS(p_id_kategorie, p_id_obrazek);

        UPDATE KVETINY
        SET nazev = v_nazev_clean,
            cena = p_cena,
            id_kategorie = p_id_kategorie,
            id_obrazek = p_id_obrazek
        WHERE id_kvetina = p_id_kvetina;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_KVETINA(v_nazev_clean, p_cena, p_id_kategorie, p_id_obrazek, o_id_kvetina, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_kvetina := p_id_kvetina;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KATEGORIE_NEEXISTUJE THEN
            o_id_kvetina := p_id_kvetina; o_status_code := -404;
            o_status_message := 'Selhání cizího klíče: Zadaná kategorie neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_OBRAZEK_NEEXISTUJE THEN
            o_id_kvetina := p_id_kvetina; o_status_code := -407;
            o_status_message := 'Selhání cizího klíče: Zadaný obrázek neexistuje.';

        WHEN OTHERS THEN
            o_id_kvetina := p_id_kvetina;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_KVETINA;

    PROCEDURE PROC_DELETE_KVETINA(
        p_id_kvetina IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM KVETINY
        WHERE id_kvetina = p_id_kvetina;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_KVETINA;
END PCK_KVETINY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_KVETINYKOSIKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_KVETINYKOSIKY" AS

    v_existuje NUMBER;

    PROCEDURE CHECK_FOREIGN_KEYS(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER
    )
    AS
    BEGIN
        BEGIN
            SELECT 1 INTO v_existuje FROM KVETINY WHERE id_kvetina = p_id_kvetina;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_KVETINA_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM KOSIKY WHERE id_kosik = p_id_kosik;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_KOSIK_NEEXISTUJE;
        END;
    END CHECK_FOREIGN_KEYS;

    PROCEDURE PROC_INSERT_KVETINYKOSIKY(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER,
        p_pocet IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_pocet KVETINYKOSIKY.POCET%TYPE;
        v_id_kvetina KVETINYKOSIKY.ID_KVETINA%TYPE := p_id_kvetina;
        v_id_kosik KVETINYKOSIKY.ID_KOSIK%TYPE := p_id_kosik;
    BEGIN
        IF p_pocet <= 0 THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_POCET;
        END IF;

        CHECK_FOREIGN_KEYS(p_id_kvetina, p_id_kosik);

        SELECT pocet INTO v_pocet 
        FROM KVETINYKOSIKY 
        WHERE id_kvetina = p_id_kvetina AND id_kosik = p_id_kosik;

        o_id_kvetina := v_id_kvetina;
        o_id_kosik := v_id_kosik;
        o_status_code := 1;
        o_status_message := 'Úspěch: Položka již existuje a byly vráceny její klíče.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO KVETINYKOSIKY(id_kvetina, id_kosik, pocet)
            VALUES(p_id_kvetina, p_id_kosik, p_pocet);

            o_id_kvetina := p_id_kvetina;
            o_id_kosik := p_id_kosik;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_POCET THEN
            o_id_kvetina := p_id_kvetina;
            o_id_kosik := p_id_kosik;
            o_status_code := -20;
            o_status_message := 'Selhání validace: Počet musí být kladné číslo (>= 1).';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KVETINA_NEEXISTUJE THEN
            o_id_kvetina := p_id_kvetina; o_id_kosik := p_id_kosik; o_status_code := -430;
            o_status_message := 'Selhání cizího klíče: Zadaná květina neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KOSIK_NEEXISTUJE THEN
            o_id_kvetina := p_id_kvetina; o_id_kosik := p_id_kosik; o_status_code := -431;
            o_status_message := 'Selhání cizího klíče: Zadaný košík neexistuje.';

        WHEN OTHERS THEN
            o_id_kvetina := p_id_kvetina;
            o_id_kosik := p_id_kosik;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_KVETINYKOSIKY;

    PROCEDURE PROC_UPDATE_KVETINYKOSIKY(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER,
        p_pocet IN NUMBER,
        o_id_kvetina OUT NUMBER,
        o_id_kosik OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        IF p_pocet <= 0 THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_POCET;
        END IF;

        CHECK_FOREIGN_KEYS(p_id_kvetina, p_id_kosik);

        UPDATE KVETINYKOSIKY
        SET pocet = p_pocet
        WHERE id_kvetina = p_id_kvetina
          AND id_kosik = p_id_kosik;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_KVETINYKOSIKY(p_id_kvetina, p_id_kosik, p_pocet, o_id_kvetina, o_id_kosik, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_kvetina := p_id_kvetina;
            o_id_kosik := p_id_kosik;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_POCET THEN
            o_id_kvetina := p_id_kvetina;
            o_id_kosik := p_id_kosik;
            o_status_code := -20;
            o_status_message := 'Selhání validace: Počet musí být kladné číslo (>= 1).';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KVETINA_NEEXISTUJE THEN
            o_id_kvetina := p_id_kvetina; o_id_kosik := p_id_kosik; o_status_code := -430;
            o_status_message := 'Selhání cizího klíče: Zadaná květina neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_KOSIK_NEEXISTUJE THEN
            o_id_kvetina := p_id_kvetina; o_id_kosik := p_id_kosik; o_status_code := -431;
            o_status_message := 'Selhání cizího klíče: Zadaný košík neexistuje.';

        WHEN OTHERS THEN
            o_id_kvetina := p_id_kvetina;
            o_id_kosik := p_id_kosik;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_KVETINYKOSIKY;

    PROCEDURE PROC_DELETE_KVETINYKOSIKY(
        p_id_kvetina IN NUMBER,
        p_id_kosik IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM KVETINYKOSIKY
        WHERE id_kvetina = p_id_kvetina
          AND id_kosik = p_id_kosik;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_KVETINYKOSIKY;
END PCK_KVETINYKOSIKY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_MESTA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_MESTA" 
AS
    PROCEDURE PROC_INSERT_MESTO(
        p_nazev           IN VARCHAR2,
        
        o_id_mesto        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_id_mesto      mesta.id_mesto%TYPE DEFAULT NULL;
        v_nazev_clean   mesta.nazev%TYPE := TRIM(p_nazev);
    BEGIN
        SELECT id_mesto
        INTO v_id_mesto
        FROM mesta
        WHERE UPPER(nazev) = UPPER(v_nazev_clean);

        o_id_mesto := v_id_mesto;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO mesta(nazev) 
            VALUES(v_nazev_clean)
            RETURNING id_mesto INTO o_id_mesto;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN OTHERS THEN
            o_id_mesto := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_MESTO;

    PROCEDURE PROC_UPDATE_MESTO(
        p_id_mesto        IN NUMBER,
        p_nazev           IN VARCHAR2,

        o_id_mesto        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_nazev_clean   mesta.nazev%TYPE := TRIM(p_nazev);
    BEGIN
        UPDATE mesta
        SET nazev = v_nazev_clean
        WHERE id_mesto = p_id_mesto;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_MESTO(v_nazev_clean, o_id_mesto, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_mesto := p_id_mesto;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;
    EXCEPTION
        WHEN OTHERS THEN
            o_id_mesto := p_id_mesto;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_MESTO;

    PROCEDURE PROC_DELETE_MESTO(
        p_id_mesto        IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM mesta
        WHERE id_mesto = p_id_mesto;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN    
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_MESTO;

END PCK_MESTA;

/
--------------------------------------------------------
--  DDL for Package Body PCK_OBRAZKY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_OBRAZKY" AS
    
    PROCEDURE PROC_INSERT_OBRAZEK(
        p_nazev_souboru  IN VARCHAR2,
        p_data           IN BLOB,
        
        o_id_obrazek     OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_obrazek OBRAZKY.ID_OBRAZEK%TYPE;
        v_name_clean OBRAZKY.NAZEV_SOUBORU%TYPE := TRIM(p_nazev_souboru);
    BEGIN
        SELECT id_obrazek
        INTO v_id_obrazek
        FROM OBRAZKY
        WHERE UPPER(nazev_souboru) = UPPER(v_name_clean);

        o_id_obrazek := v_id_obrazek;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO OBRAZKY(nazev_souboru, data)
            VALUES (v_name_clean, p_data)
            RETURNING id_obrazek INTO o_id_obrazek;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN OTHERS THEN
            o_id_obrazek := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_OBRAZEK;

    PROCEDURE PROC_UPDATE_OBRAZEK(
        p_id_obrazek     IN NUMBER,
        p_nazev_souboru  IN VARCHAR2,
        p_data           IN BLOB,

        o_id_obrazek     OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_name_clean OBRAZKY.NAZEV_SOUBORU%TYPE := TRIM(p_nazev_souboru);
    BEGIN
        UPDATE OBRAZKY
        SET nazev_souboru = v_name_clean,
            data = p_data
        WHERE id_obrazek = p_id_obrazek;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_OBRAZEK(v_name_clean, p_data, o_id_obrazek, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_obrazek := p_id_obrazek;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            o_id_obrazek := p_id_obrazek;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_OBRAZEK;

    PROCEDURE PROC_DELETE_OBRAZEK(
        p_id_obrazek     IN NUMBER,

        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM OBRAZKY
        WHERE id_obrazek = p_id_obrazek;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_OBRAZEK;
END PCK_OBRAZKY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_OPRAVNENI
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_OPRAVNENI" AS
    
    PROCEDURE PROC_INSERT_OPRAVNENI(
        p_nazev IN VARCHAR2,
        p_uroven IN NUMBER,
        o_id_opravneni OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_opravneni OPRAVNENI.ID_OPRAVNENI%TYPE;
        v_nazev_clean OPRAVNENI.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        IF p_uroven NOT IN (0, 1, 2, 3) THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_INVALID_UROVEN;
        END IF;

        SELECT id_opravneni
        INTO v_id_opravneni
        FROM OPRAVNENI
        WHERE UPPER(nazev) = UPPER(v_nazev_clean)
          AND uroven = p_uroven;

        o_id_opravneni := v_id_opravneni;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO OPRAVNENI(nazev, uroven)
            VALUES (v_nazev_clean, p_uroven)
            RETURNING id_opravneni INTO o_id_opravneni;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_INVALID_UROVEN THEN
            o_id_opravneni := NULL;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: Úroveň oprávnění musí být 0, 1, 2 nebo 3.';

        WHEN OTHERS THEN
            o_id_opravneni := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_OPRAVNENI;

    PROCEDURE PROC_UPDATE_OPRAVNENI(
        p_id_opravneni IN NUMBER,
        p_nazev IN VARCHAR2,
        p_uroven IN NUMBER,
        o_id_opravneni OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_nazev_clean OPRAVNENI.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        IF p_uroven NOT IN (0, 1, 2, 3) THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_INVALID_UROVEN;
        END IF;

        UPDATE OPRAVNENI
        SET nazev = v_nazev_clean,
            uroven = p_uroven
        WHERE id_opravneni = p_id_opravneni;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_OPRAVNENI(v_nazev_clean, p_uroven, o_id_opravneni, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_opravneni := p_id_opravneni;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_INVALID_UROVEN THEN
            o_id_opravneni := p_id_opravneni;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: Úroveň oprávnění musí být 0, 1, 2 nebo 3.';
        WHEN OTHERS THEN
            o_id_opravneni := p_id_opravneni;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_OPRAVNENI;

    PROCEDURE PROC_DELETE_OPRAVNENI(
        p_id_opravneni IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM OPRAVNENI
        WHERE id_opravneni = p_id_opravneni;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_OPRAVNENI;
END PCK_OPRAVNENI;

/
--------------------------------------------------------
--  DDL for Package Body PCK_PLATBY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_PLATBY" AS
    
    PROCEDURE PROC_INSERT_PLATBA(
        p_nazev IN VARCHAR2,
        o_id_zpusob_platby OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_platby ZPUSOBYPLATEB.ID_ZPUSOB_PLATBY%TYPE;
        v_nazev_clean ZPUSOBYPLATEB.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        SELECT id_zpusob_platby
        INTO v_id_platby
        FROM ZPUSOBYPLATEB
        WHERE UPPER(nazev) = UPPER(v_nazev_clean);

        o_id_zpusob_platby := v_id_platby;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO ZPUSOBYPLATEB(nazev)
            VALUES (v_nazev_clean)
            RETURNING id_zpusob_platby INTO o_id_zpusob_platby;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN OTHERS THEN
            o_id_zpusob_platby := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_PLATBA;

    PROCEDURE PROC_UPDATE_PLATBA(
        p_id_zpusob_platby IN NUMBER,
        p_nazev IN VARCHAR2,
        o_id_zpusob_platby OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_nazev_clean ZPUSOBYPLATEB.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        UPDATE ZPUSOBYPLATEB
        SET nazev = v_nazev_clean
        WHERE id_zpusob_platby = p_id_zpusob_platby;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_PLATBA(v_nazev_clean, o_id_zpusob_platby, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_zpusob_platby := p_id_zpusob_platby;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            o_id_zpusob_platby := p_id_zpusob_platby;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_PLATBA;

    PROCEDURE PROC_DELETE_PLATBA(
        p_id_zpusob_platby IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM ZPUSOBYPLATEB
        WHERE id_zpusob_platby = p_id_zpusob_platby;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_PLATBA;
END PCK_PLATBY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_PSC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_PSC" 
AS
    

    PROCEDURE PROC_INSERT_PSC(
        p_psc             IN VARCHAR2,
        
        o_id_psc          OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_id_psc      psc.id_psc%TYPE DEFAULT NULL;
        v_psc_clean   VARCHAR2(128) := TRIM(p_psc); 
    BEGIN
        IF LENGTH(v_psc_clean) != 5 OR NOT REGEXP_LIKE(v_psc_clean, '^[0-9]{5}$') THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_INVALID_PSC_FORMAT;
        END IF;

        SELECT id_psc
        INTO v_id_psc
        FROM psc
        WHERE UPPER(psc) = UPPER(v_psc_clean); 

        o_id_psc := v_id_psc;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO psc(psc) 
            VALUES(v_psc_clean)
            RETURNING id_psc INTO o_id_psc;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_INVALID_PSC_FORMAT THEN
            o_id_psc := NULL;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: PSČ musí být přesně 5 číslic.';

        WHEN VALUE_ERROR THEN
            o_id_psc := NULL;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: PSČ musí být přesně 5 číslic.';

        WHEN OTHERS THEN
            o_id_psc := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_PSC;

    PROCEDURE PROC_UPDATE_PSC(
        p_id_psc          IN NUMBER,
        p_psc             IN VARCHAR2,

        o_id_psc          OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_psc_clean       VARCHAR2(128) := TRIM(p_psc); 
    BEGIN
        UPDATE psc
        SET psc = v_psc_clean
        WHERE id_psc = p_id_psc;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_PSC(v_psc_clean, o_id_psc, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_psc := p_id_psc;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN VALUE_ERROR THEN
            o_id_psc := NULL;
            o_status_code := -20; 
            o_status_message := 'Selhání validace: PSČ musí být přesně 5 číslic.';

        WHEN OTHERS THEN
            o_id_psc := p_id_psc;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_PSC;

    PROCEDURE PROC_DELETE_PSC(
        p_id_psc          IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM psc
        WHERE id_psc = p_id_psc;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND; 
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN    
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_PSC;

END PCK_PSC;

/
--------------------------------------------------------
--  DDL for Package Body PCK_STAVY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_STAVY" AS
    
    PROCEDURE PROC_INSERT_STAV(
        p_nazev          IN VARCHAR2,
        
        o_id             OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_stav     STAVYOBJEDNAVEK.ID_STAV_OBJEDNAVKY%TYPE;
        v_nazev_clean STAVYOBJEDNAVEK.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        SELECT id_stav_objednavky
        INTO v_id_stav
        FROM STAVYOBJEDNAVEK
        WHERE UPPER(nazev) = UPPER(v_nazev_clean);

        o_id := v_id_stav;
        o_status_code := -2;
        o_status_message := 'Vložení selhalo: Stav objednávky s tímto názvem již existuje.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO STAVYOBJEDNAVEK(nazev)
            VALUES (v_nazev_clean)
            RETURNING id_stav_objednavky INTO o_id;

            o_status_code := 1;
            o_status_message := 'Stav objednávky byl úspěšně vložen.';

        WHEN OTHERS THEN
            o_id := NULL;
            o_status_code := -1;
            o_status_message := 'Neočekávaná chyba při vkládání: ' || SQLERRM;
    END PROC_INSERT_STAV;


    PROCEDURE PROC_UPDATE_STAV(
        p_id             IN NUMBER,
        p_nazev          IN VARCHAR2,

        o_id             OUT NUMBER,
        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_nazev_clean STAVYOBJEDNAVEK.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        UPDATE STAVYOBJEDNAVEK
        SET nazev = v_nazev_clean
        WHERE id_stav_objednavky = p_id;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_STAV(v_nazev_clean, o_id, o_status_code, o_status_message);

            IF o_status_code = 1 THEN
                o_status_message := 'Záznam nebyl nalezen, byl vytvořen nový stav objednávky.';
            END IF;

        ELSE
            o_id := p_id;
            o_status_code := 1;
            o_status_message := 'Stav objednávky byl úspěšně upraven.';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            o_id := p_id;
            o_status_code := -1;
            o_status_message := 'Neočekávaná chyba při aktualizaci: ' || SQLERRM;
    END PROC_UPDATE_STAV;


    PROCEDURE PROC_DELETE_STAV(
        p_id             IN NUMBER,

        o_status_code    OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM STAVYOBJEDNAVEK WHERE id_stav_objednavky = p_id;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Stav objednávky byl úspěšně smazán.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN 
            o_status_code := 0;
            o_status_message := 'Smazání selhalo: Stav objednávky nebyl nalezen.';

        WHEN OTHERS THEN
            o_status_code := -1;
            o_status_message := 'Neočekávaná chyba při mazání: ' || SQLERRM;
    END PROC_DELETE_STAV;
END PCK_STAVY;

/
--------------------------------------------------------
--  DDL for Package Body PCK_STAVYOBJEDNAVEK
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_STAVYOBJEDNAVEK" AS
    
    PROCEDURE PROC_INSERT_STAV(
        p_nazev IN VARCHAR2,
        o_id_stav_objednavky OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_stav STAVYOBJEDNAVEK.ID_STAV_OBJEDNAVKY%TYPE;
        v_nazev_clean STAVYOBJEDNAVEK.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        SELECT id_stav_objednavky
        INTO v_id_stav
        FROM STAVYOBJEDNAVEK
        WHERE UPPER(nazev) = UPPER(v_nazev_clean);

        o_id_stav_objednavky := v_id_stav;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO STAVYOBJEDNAVEK(nazev)
            VALUES (v_nazev_clean)
            RETURNING id_stav_objednavky INTO o_id_stav_objednavky;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN OTHERS THEN
            o_id_stav_objednavky := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_STAV;

    PROCEDURE PROC_UPDATE_STAV(
        p_id_stav_objednavky IN NUMBER,
        p_nazev IN VARCHAR2,
        o_id_stav_objednavky OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_nazev_clean STAVYOBJEDNAVEK.NAZEV%TYPE := TRIM(p_nazev);
    BEGIN
        UPDATE STAVYOBJEDNAVEK
        SET nazev = v_nazev_clean
        WHERE id_stav_objednavky = p_id_stav_objednavky;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_STAV(v_nazev_clean, o_id_stav_objednavky, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_stav_objednavky := p_id_stav_objednavky;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            o_id_stav_objednavky := p_id_stav_objednavky;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_STAV;

    PROCEDURE PROC_DELETE_STAV(
        p_id_stav_objednavky IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM STAVYOBJEDNAVEK
        WHERE id_stav_objednavky = p_id_stav_objednavky;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_STAV;
END PCK_STAVYOBJEDNAVEK;

/
--------------------------------------------------------
--  DDL for Package Body PCK_ULICE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_ULICE" 
AS
    PROCEDURE PROC_INSERT_ULICE(
        p_nazev           IN VARCHAR2,
        
        o_id_ulice        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_id_ulice      ulice.id_ulice%TYPE DEFAULT NULL;
        v_nazev_clean   ulice.nazev%TYPE := TRIM(p_nazev);
    BEGIN
        SELECT id_ulice
        INTO v_id_ulice
        FROM ulice
        WHERE UPPER(nazev) = UPPER(v_nazev_clean);

        o_id_ulice := v_id_ulice;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            INSERT INTO ulice(nazev) 
            VALUES(v_nazev_clean)
            RETURNING id_ulice INTO o_id_ulice;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN OTHERS THEN
            o_id_ulice := NULL;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_ULICE;

    PROCEDURE PROC_UPDATE_ULICE(
        p_id_ulice        IN NUMBER,
        p_nazev           IN VARCHAR2,

        o_id_ulice        OUT NUMBER,
        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
        v_nazev_clean   ulice.nazev%TYPE := TRIM(p_nazev);
    BEGIN
        UPDATE ulice
        SET nazev = v_nazev_clean
        WHERE id_ulice = p_id_ulice;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_ULICE(v_nazev_clean, o_id_ulice, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_ulice := p_id_ulice;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN OTHERS THEN
            o_id_ulice := p_id_ulice;
            o_status_code := -999; 
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_ULICE;

    PROCEDURE PROC_DELETE_ULICE(
        p_id_ulice        IN NUMBER,

        o_status_code     OUT NUMBER,
        o_status_message  OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM ulice
        WHERE id_ulice = p_id_ulice;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN    
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_ULICE;

END PCK_ULICE;

/
--------------------------------------------------------
--  DDL for Package Body PCK_UZIVATELE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE BODY "ST67009"."PCK_UZIVATELE" AS
    
    v_existuje NUMBER;

    FUNCTION FUNC_IS_EMAIL_VALID(p_email IN VARCHAR2) RETURN BOOLEAN
    AS
    BEGIN
        RETURN REGEXP_LIKE(p_email, '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$');
    END FUNC_IS_EMAIL_VALID;

    PROCEDURE CHECK_FOREIGN_KEYS(
        p_id_opravneni IN NUMBER,
        p_id_obrazek IN NUMBER,
        p_id_adresa IN NUMBER
    )
    AS
    BEGIN
        BEGIN
            SELECT 1 INTO v_existuje FROM OPRAVNENI WHERE id_opravneni = p_id_opravneni;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_OPRAVNENI_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM OBRAZKY WHERE id_obrazek = p_id_obrazek;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_OBRAZEK_NEEXISTUJE;
        END;

        BEGIN
            SELECT 1 INTO v_existuje FROM ADRESY WHERE id_adresa = p_id_adresa;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN RAISE PCK_GLOBAL_EXCEPTIONS.E_FK_ADRESA_NEEXISTUJE;
        END;
    END CHECK_FOREIGN_KEYS;

    PROCEDURE PROC_INSERT_UZIVATEL(
        p_email IN VARCHAR2,
        p_pw_hash IN CHAR,
        p_salt IN CHAR,
        p_id_opravneni IN NUMBER,
        p_id_obrazek IN NUMBER,
        p_id_adresa IN NUMBER,
        o_id_uzivatel OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_id_uzivatel UZIVATELE.ID_UZIVATEL%TYPE;
        v_email_clean UZIVATELE.EMAIL%TYPE := TRIM(p_email);
    BEGIN
        IF FUNC_IS_EMAIL_VALID(v_email_clean) = FALSE THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_FORMAT_EMAILU;
        END IF;

        SELECT id_uzivatel INTO v_id_uzivatel FROM UZIVATELE WHERE UPPER(email) = UPPER(v_email_clean);

        o_id_uzivatel := v_id_uzivatel;
        o_status_code := 1;
        o_status_message := 'Úspěch: Záznam již existuje a bylo vráceno jeho ID.';

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            CHECK_FOREIGN_KEYS(p_id_opravneni, p_id_obrazek, p_id_adresa);

            INSERT INTO UZIVATELE(email, pw_hash, salt, id_opravneni, id_obrazek, id_adresa)
            VALUES (v_email_clean, p_pw_hash, p_salt, p_id_opravneni, p_id_obrazek, p_id_adresa)
            RETURNING id_uzivatel INTO o_id_uzivatel;

            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_FORMAT_EMAILU THEN
            o_id_uzivatel := NULL;
            o_status_code := -23;
            o_status_message := 'Selhání validace: Neplatný formát emailu.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_OPRAVNENI_NEEXISTUJE THEN
            o_id_uzivatel := NULL; o_status_code := -420;
            o_status_message := 'Selhání cizího klíče: Zadané ID oprávnění neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_OBRAZEK_NEEXISTUJE THEN
            o_id_uzivatel := NULL; o_status_code := -407;
            o_status_message := 'Selhání cizího klíče: Zadané ID obrázku neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_ADRESA_NEEXISTUJE THEN
            o_id_uzivatel := NULL; o_status_code := -422;
            o_status_message := 'Selhání cizího klíče: Zadané ID adresy neexistuje.';

        WHEN OTHERS THEN
            o_id_uzivatel := NULL;
            o_status_code := -999;
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_INSERT_UZIVATEL;

    PROCEDURE PROC_UPDATE_UZIVATEL(
        p_id_uzivatel IN NUMBER,
        p_email IN VARCHAR2,
        p_pw_hash IN CHAR,
        p_salt IN CHAR,
        p_id_opravneni IN NUMBER,
        p_id_obrazek IN NUMBER,
        p_id_adresa IN NUMBER,
        o_id_uzivatel OUT NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
        v_email_clean UZIVATELE.EMAIL%TYPE := TRIM(p_email);
    BEGIN
        IF FUNC_IS_EMAIL_VALID(v_email_clean) = FALSE THEN
            RAISE PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_FORMAT_EMAILU;
        END IF;

        CHECK_FOREIGN_KEYS(p_id_opravneni, p_id_obrazek, p_id_adresa);

        UPDATE UZIVATELE
        SET email = v_email_clean,
            pw_hash = p_pw_hash,
            salt = p_salt,
            id_opravneni = p_id_opravneni,
            id_obrazek = p_id_obrazek,
            id_adresa = p_id_adresa
        WHERE id_uzivatel = p_id_uzivatel;

        IF SQL%ROWCOUNT = 0 THEN
            PROC_INSERT_UZIVATEL(v_email_clean, p_pw_hash, p_salt, p_id_opravneni, p_id_obrazek, p_id_adresa, o_id_uzivatel, o_status_code, o_status_message);
            IF o_status_code = 1 THEN
                o_status_message := 'Úspěch: Záznam nebyl nalezen, byl místo toho vytvořen nový záznam.';
            END IF;
        ELSE
            o_id_uzivatel := p_id_uzivatel;
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        END IF;

    EXCEPTION
        WHEN PCK_GLOBAL_EXCEPTIONS.E_NEPLATNY_FORMAT_EMAILU THEN
            o_id_uzivatel := p_id_uzivatel;
            o_status_code := -23;
            o_status_message := 'Selhání validace: Neplatný formát emailu.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_OPRAVNENI_NEEXISTUJE THEN
            o_id_uzivatel := p_id_uzivatel; o_status_code := -420;
            o_status_message := 'Selhání cizího klíče: Zadané ID oprávnění neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_OBRAZEK_NEEXISTUJE THEN
            o_id_uzivatel := p_id_uzivatel; o_status_code := -407;
            o_status_message := 'Selhání cizího klíče: Zadané ID obrázku neexistuje.';

        WHEN PCK_GLOBAL_EXCEPTIONS.E_FK_ADRESA_NEEXISTUJE THEN
            o_id_uzivatel := p_id_uzivatel; o_status_code := -422;
            o_status_message := 'Selhání cizího klíče: Zadané ID adresy neexistuje.';

        WHEN OTHERS THEN
            o_id_uzivatel := p_id_uzivatel;
            o_status_code := -999;
            o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
    END PROC_UPDATE_UZIVATEL;

    PROCEDURE PROC_DELETE_UZIVATEL(
        p_id_uzivatel IN NUMBER,
        o_status_code OUT NUMBER,
        o_status_message OUT VARCHAR2
    )
    AS
    BEGIN
        DELETE FROM UZIVATELE
        WHERE id_uzivatel = p_id_uzivatel;

        IF SQL%ROWCOUNT = 1 THEN
            o_status_code := 1;
            o_status_message := 'Úspěch: Operace proběhla úspěšně.';
        ELSE
            RAISE NO_DATA_FOUND;
        END IF;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            o_status_code := 0; 
            o_status_message := 'Selhání odstranění: Záznam nebyl nalezen.';

        WHEN OTHERS THEN
            IF SQLCODE = -2292 THEN 
                o_status_code := -30;
                o_status_message := 'Selhání odstranění: Záznam nelze smazat, protože má podřízené prvky.';
            ELSE
                o_status_code := -999; 
                o_status_message := 'Kritická chyba: Neočekávaná chyba: ' || SQLERRM;
            END IF;
    END PROC_DELETE_UZIVATEL;
END PCK_UZIVATELE;

/
--------------------------------------------------------
--  DDL for Function IS_VALID_EMAIL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "ST67009"."IS_VALID_EMAIL" 
(
  EMAIL IN VARCHAR2  
) RETURN NUMBER AS
  
  i_result NUMBER;

BEGIN

  SELECT 
    COUNT(*) INTO i_result 
  FROM
    dual 
  WHERE 
    REGEXP_LIKE(EMAIL,'^[a-zA-Z0-9._-]+@+[a-zA-Z0-9.-]+\.+[a-zA-Z]{2,4}$');

  RETURN i_result;

END IS_VALID_EMAIL;

/
--------------------------------------------------------
--  DDL for Function IS_VALID_RC
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "ST67009"."IS_VALID_RC" 
(
  RC IN NUMBER  
) RETURN NUMBER AS

  i_zbytek NUMBER;
  i_mesic NUMBER;
  i_rok NUMBER;
  i_den NUMBER;
  i_datum DATE;

BEGIN

  IF LENGTH(RC) NOT BETWEEN 9 AND 10 THEN
    RETURN 0;
  END IF;

  -- rodn� ��slo p�ed rokem 1954
  IF LENGTH(RC) = 9 AND SUBSTR(RC,1,2) < 54 THEN
    RETURN 1;
  END IF;

  -- zbytek po d�len� 11 prvn�ch deviti ��sel
  i_zbytek := MOD(SUBSTR(RC,1,9),11);

  IF i_zbytek = 10 THEN
    i_zbytek := 0;
  END IF;

  i_rok := TO_NUMBER(SUBSTR(RC,1,2));
  i_mesic := TO_NUMBER(SUBSTR(RC,3,2));
  i_den := TO_NUMBER(SUBSTR(RC,5,2));

  IF i_rok < 54 THEN
    i_rok := i_rok + 2000;
  ELSE
    i_rok := i_rok + 1900;
  END IF;

  -- ode��tan� 20,50,70 v p��pad� �ensk�ho RC
  IF i_mesic > 70 AND i_rok > 2003 THEN
    i_mesic := i_mesic - 70;
  ELSIF i_mesic > 50 THEN
    i_mesic := i_mesic - 50;
  ELSIF i_mesic > 20 AND i_rok > 2003 THEN
    i_mesic := i_mesic - 20;
  END IF;

  -- kontrola, zda je to platn� datum.
  BEGIN
    i_datum := TO_DATE(i_den || '.' || i_mesic || '.' || i_rok,'DD.MM.YYYY');
  EXCEPTION WHEN OTHERS THEN
    RETURN 0;
  END;

    -- rovn� se zbytek posledn� ��slici?
  IF i_zbytek = SUBSTR(RC,10,1) THEN
    RETURN 1;
  ELSE
    RETURN 0;
  END IF;

END IS_VALID_RC;

/
--------------------------------------------------------
--  DDL for Function LOAJALITA_ZAMESTNANCU
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "ST67009"."LOAJALITA_ZAMESTNANCU" (p_datum DATE)
RETURN VARCHAR2
AS
    i_zarazeni NUMBER := (SYSDATE - p_datum) / 365;
BEGIN
    CASE
        WHEN i_zarazeni >= 0 AND i_zarazeni < 5 THEN RETURN 'Zelenáč';
        WHEN i_zarazeni >= 5 AND i_zarazeni < 10 THEN RETURN 'Zasloužilý';
        WHEN i_zarazeni >= 10 THEN RETURN 'Matador';
        ELSE RETURN 'Neznámý';
    END CASE;
END loajalita_zamestnancu;

/
--------------------------------------------------------
--  DDL for Function MD5HASH
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "ST67009"."MD5HASH" (str IN VARCHAR2)
RETURN VARCHAR2
IS v_checksum VARCHAR2(32);
BEGIN
v_checksum := LOWER( RAWTOHEX( UTL_RAW.CAST_TO_RAW(
sys.dbms_obfuscation_toolkit.md5(input_string => str) ) ) );
RETURN v_checksum;
EXCEPTION WHEN NO_DATA_FOUND THEN NULL;
WHEN OTHERS THEN -- Consider logging the error and then re-raise
RAISE;
END md5hash;

/

  GRANT EXECUTE ON "ST67009"."MD5HASH" TO PUBLIC;
--------------------------------------------------------
--  DDL for Function POMER_PLAT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "ST67009"."POMER_PLAT" (p_mzda NUMBER, p_oddeleni_id NUMBER DEFAULT NULL)
RETURN VARCHAR2
AS
    v_pomer NUMBER;
BEGIN
    SELECT (p_mzda/AVG(mzda)) * 100 
    INTO v_pomer
    FROM A_HR.zamestnanci
    WHERE oddeleni_id = NVL(p_oddeleni_id, oddeleni_id);

    RETURN ROUND(v_pomer, 2) || ' %';
EXCEPTION
    WHEN OTHERS THEN
        RETURN 'Chyba vypoctu';
END pomer_plat;

/
--------------------------------------------------------
--  Constraints for Table KATEGORIE
--------------------------------------------------------

  ALTER TABLE "ST67009"."KATEGORIE" ADD CONSTRAINT "KATEGORIE_PK" PRIMARY KEY ("ID_KATEGORIE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."KATEGORIE" MODIFY ("ID_KATEGORIE" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KATEGORIE" MODIFY ("NAZEV" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table LOGAKCE
--------------------------------------------------------

  ALTER TABLE "ST67009"."LOGAKCE" ADD CONSTRAINT "LOGAKCE_PK" PRIMARY KEY ("ID_LOG_AKCE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."LOGAKCE" MODIFY ("ID_LOG_AKCE" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."LOGAKCE" MODIFY ("NAZEV" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table DOTAZY
--------------------------------------------------------

  ALTER TABLE "ST67009"."DOTAZY" ADD CONSTRAINT "BOOLEAN_HODNOTY" CHECK (verejny IN (0, 1)) ENABLE;
  ALTER TABLE "ST67009"."DOTAZY" ADD CONSTRAINT "DOTAZY_PK" PRIMARY KEY ("ID_DOTAZ")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."DOTAZY" MODIFY ("ID_DOTAZ" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."DOTAZY" MODIFY ("DATUM_PODANI" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."DOTAZY" MODIFY ("VEREJNY" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."DOTAZY" MODIFY ("TEXT" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table ZPUSOBYPLATEB
--------------------------------------------------------

  ALTER TABLE "ST67009"."ZPUSOBYPLATEB" MODIFY ("ID_ZPUSOB_PLATBY" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ZPUSOBYPLATEB" MODIFY ("NAZEV" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ZPUSOBYPLATEB" ADD CONSTRAINT "ZPUSOBYPLATEB_PK" PRIMARY KEY ("ID_ZPUSOB_PLATBY")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
--------------------------------------------------------
--  Constraints for Table OBRAZKY
--------------------------------------------------------

  ALTER TABLE "ST67009"."OBRAZKY" ADD CONSTRAINT "OBRAZKY_PK" PRIMARY KEY ("ID_OBRAZEK")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."OBRAZKY" MODIFY ("ID_OBRAZEK" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."OBRAZKY" MODIFY ("NAZEV_SOUBORU" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."OBRAZKY" MODIFY ("DATA" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table OPRAVNENI
--------------------------------------------------------

  ALTER TABLE "ST67009"."OPRAVNENI" ADD CONSTRAINT "OPRAVNENI_PK" PRIMARY KEY ("ID_OPRAVNENI")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."OPRAVNENI" MODIFY ("ID_OPRAVNENI" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."OPRAVNENI" MODIFY ("NAZEV" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."OPRAVNENI" MODIFY ("UROVEN" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."OPRAVNENI" ADD CHECK (uroven IN (0, 1, 2, 3)) ENABLE;
--------------------------------------------------------
--  Constraints for Table KOSIKY
--------------------------------------------------------

  ALTER TABLE "ST67009"."KOSIKY" ADD CONSTRAINT "KOSIKY_PK" PRIMARY KEY ("ID_KOSIK")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."KOSIKY" MODIFY ("ID_KOSIK" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KOSIKY" MODIFY ("DATUM_VYTVORENI" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KOSIKY" MODIFY ("CENA" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KOSIKY" MODIFY ("ID_UZIVATEL" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KOSIKY" MODIFY ("ID_STAV_OBJEDNAVKY" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KOSIKY" MODIFY ("ID_ZPUSOB_PLATBY" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table MESTA
--------------------------------------------------------

  ALTER TABLE "ST67009"."MESTA" ADD CONSTRAINT "MESTA_PK" PRIMARY KEY ("ID_MESTO")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."MESTA" MODIFY ("ID_MESTO" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."MESTA" MODIFY ("NAZEV" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table LOGS
--------------------------------------------------------

  ALTER TABLE "ST67009"."LOGS" ADD CONSTRAINT "LOG_PK" PRIMARY KEY ("ID_LOG")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."LOGS" MODIFY ("ID_LOG" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."LOGS" MODIFY ("NAZEV_TABULKY" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."LOGS" MODIFY ("DATUM" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."LOGS" MODIFY ("NOVY_ZAZNAM" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."LOGS" MODIFY ("ID_LOG_AKCE" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table KVETINYKOSIKY
--------------------------------------------------------

  ALTER TABLE "ST67009"."KVETINYKOSIKY" ADD CONSTRAINT "RELATION_25_PK" PRIMARY KEY ("ID_KVETINA", "ID_KOSIK")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."KVETINYKOSIKY" MODIFY ("ID_KVETINA" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KVETINYKOSIKY" MODIFY ("ID_KOSIK" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KVETINYKOSIKY" MODIFY ("POCET" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table UZIVATELE
--------------------------------------------------------

  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("ID_UZIVATEL" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("EMAIL" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("PW_HASH" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("SALT" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("ID_OPRAVNENI" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("ID_OBRAZEK" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" MODIFY ("ID_ADRESA" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."UZIVATELE" ADD CONSTRAINT "UZIVATELE_PK" PRIMARY KEY ("ID_UZIVATEL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
--------------------------------------------------------
--  Constraints for Table STAVYOBJEDNAVEK
--------------------------------------------------------

  ALTER TABLE "ST67009"."STAVYOBJEDNAVEK" ADD CONSTRAINT "STAVYOBJEDNAVEK_PK" PRIMARY KEY ("ID_STAV_OBJEDNAVKY")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."STAVYOBJEDNAVEK" MODIFY ("ID_STAV_OBJEDNAVKY" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."STAVYOBJEDNAVEK" MODIFY ("NAZEV" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table ADRESY
--------------------------------------------------------

  ALTER TABLE "ST67009"."ADRESY" ADD CONSTRAINT "ADRESY_PK" PRIMARY KEY ("ID_ADRESA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."ADRESY" MODIFY ("ID_ADRESA" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ADRESY" MODIFY ("CP" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ADRESY" MODIFY ("ID_MESTO" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ADRESY" MODIFY ("ID_ULICE" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ADRESY" MODIFY ("ID_PSC" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table KVETINY
--------------------------------------------------------

  ALTER TABLE "ST67009"."KVETINY" ADD CONSTRAINT "KVETINY_PK" PRIMARY KEY ("ID_KVETINA")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."KVETINY" MODIFY ("ID_KVETINA" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KVETINY" MODIFY ("NAZEV" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KVETINY" MODIFY ("CENA" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KVETINY" MODIFY ("ID_KATEGORIE" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."KVETINY" MODIFY ("ID_OBRAZEK" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table PSC
--------------------------------------------------------

  ALTER TABLE "ST67009"."PSC" ADD CONSTRAINT "PSC_PK" PRIMARY KEY ("ID_PSC")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
  ALTER TABLE "ST67009"."PSC" MODIFY ("ID_PSC" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."PSC" MODIFY ("PSC" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table ULICE
--------------------------------------------------------

  ALTER TABLE "ST67009"."ULICE" MODIFY ("ID_ULICE" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ULICE" MODIFY ("NAZEV" NOT NULL ENABLE);
  ALTER TABLE "ST67009"."ULICE" ADD CONSTRAINT "ULICE_PK" PRIMARY KEY ("ID_ULICE")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "STUDENTI"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table ADRESY
--------------------------------------------------------

  ALTER TABLE "ST67009"."ADRESY" ADD CONSTRAINT "ADRESY_MESTA_FK" FOREIGN KEY ("ID_MESTO")
	  REFERENCES "ST67009"."MESTA" ("ID_MESTO") ENABLE;
  ALTER TABLE "ST67009"."ADRESY" ADD CONSTRAINT "ADRESY_PSC_FK" FOREIGN KEY ("ID_PSC")
	  REFERENCES "ST67009"."PSC" ("ID_PSC") ENABLE;
  ALTER TABLE "ST67009"."ADRESY" ADD CONSTRAINT "ADRESY_ULICE_FK" FOREIGN KEY ("ID_ULICE")
	  REFERENCES "ST67009"."ULICE" ("ID_ULICE") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table DOTAZY
--------------------------------------------------------

  ALTER TABLE "ST67009"."DOTAZY" ADD CONSTRAINT "DOTAZY_UZIVATELE_FK" FOREIGN KEY ("ID_ODPOVIDAJICI_UZIVATEL")
	  REFERENCES "ST67009"."UZIVATELE" ("ID_UZIVATEL") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table KATEGORIE
--------------------------------------------------------

  ALTER TABLE "ST67009"."KATEGORIE" ADD CONSTRAINT "KATEGORIE_KATEGORIE_FK" FOREIGN KEY ("ID_NADRAZENE_KATEGORIE")
	  REFERENCES "ST67009"."KATEGORIE" ("ID_KATEGORIE") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table KOSIKY
--------------------------------------------------------

  ALTER TABLE "ST67009"."KOSIKY" ADD CONSTRAINT "KOSIKY_STAVYOBJEDNAVEK_FK" FOREIGN KEY ("ID_STAV_OBJEDNAVKY")
	  REFERENCES "ST67009"."STAVYOBJEDNAVEK" ("ID_STAV_OBJEDNAVKY") ENABLE;
  ALTER TABLE "ST67009"."KOSIKY" ADD CONSTRAINT "KOSIKY_UZIVATELE_FK" FOREIGN KEY ("ID_UZIVATEL")
	  REFERENCES "ST67009"."UZIVATELE" ("ID_UZIVATEL") ENABLE;
  ALTER TABLE "ST67009"."KOSIKY" ADD CONSTRAINT "KOSIKY_ZPUSOBYPLATEB_FK" FOREIGN KEY ("ID_ZPUSOB_PLATBY")
	  REFERENCES "ST67009"."ZPUSOBYPLATEB" ("ID_ZPUSOB_PLATBY") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table KVETINY
--------------------------------------------------------

  ALTER TABLE "ST67009"."KVETINY" ADD CONSTRAINT "KVETINY_KATEGORIE_FK" FOREIGN KEY ("ID_KATEGORIE")
	  REFERENCES "ST67009"."KATEGORIE" ("ID_KATEGORIE") ENABLE;
  ALTER TABLE "ST67009"."KVETINY" ADD CONSTRAINT "KVETINY_OBRAZKY_FK" FOREIGN KEY ("ID_OBRAZEK")
	  REFERENCES "ST67009"."OBRAZKY" ("ID_OBRAZEK") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table KVETINYKOSIKY
--------------------------------------------------------

  ALTER TABLE "ST67009"."KVETINYKOSIKY" ADD CONSTRAINT "KVETINYKOSIKY_KOSIKY_FK" FOREIGN KEY ("ID_KOSIK")
	  REFERENCES "ST67009"."KOSIKY" ("ID_KOSIK") ENABLE;
  ALTER TABLE "ST67009"."KVETINYKOSIKY" ADD CONSTRAINT "KVETINYKOSIKY_KVETINY_FK" FOREIGN KEY ("ID_KVETINA")
	  REFERENCES "ST67009"."KVETINY" ("ID_KVETINA") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table LOGS
--------------------------------------------------------

  ALTER TABLE "ST67009"."LOGS" ADD CONSTRAINT "LOG_LOGAKCE_FK" FOREIGN KEY ("ID_LOG_AKCE")
	  REFERENCES "ST67009"."LOGAKCE" ("ID_LOG_AKCE") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table UZIVATELE
--------------------------------------------------------

  ALTER TABLE "ST67009"."UZIVATELE" ADD CONSTRAINT "UZIVATELE_ADRESY_FK" FOREIGN KEY ("ID_ADRESA")
	  REFERENCES "ST67009"."ADRESY" ("ID_ADRESA") ENABLE;
  ALTER TABLE "ST67009"."UZIVATELE" ADD CONSTRAINT "UZIVATELE_OBRAZKY_FK" FOREIGN KEY ("ID_OBRAZEK")
	  REFERENCES "ST67009"."OBRAZKY" ("ID_OBRAZEK") ENABLE;
  ALTER TABLE "ST67009"."UZIVATELE" ADD CONSTRAINT "UZIVATELE_OPRAVNENI_FK" FOREIGN KEY ("ID_OPRAVNENI")
	  REFERENCES "ST67009"."OPRAVNENI" ("ID_OPRAVNENI") ENABLE;
